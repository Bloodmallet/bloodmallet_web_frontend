function bloodmallet_chart_import(){const e=["#7cb5ec","#d9d9df","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"],t="#343a40",o="#f8f9fa",a="#828282",l="1.1rem",r=!1,i="https://bloodmallet.com/chart/get/",n={cn:"cn_CN",en:"en_US",de:"de_DE",es:"es_ES",fr:"fr_FR",it:"it_IT",ko:"ko_KR",pt:"pt_BR",ru:"ru_RU"},s={Kyrian:{id:1,color:"#69ccf0"},Venthyr:{id:2,color:"#c41f3b"},"Night Fae":{id:3,color:"#a330c9"},Necrolord:{id:4,color:"#abd473"}};function d(e){r&&console.log("load_data");let t=e.chart_id,o=e.data_type,a=e.fight_style,l=e.wow_class,n=e.wow_spec;try{if(c(e))return}catch(e){r&&console.log("Data needs to be loaded.")}let s=o;s.indexOf("azerite")>-1&&(s="azerite_traits");let d=a;d+="/"+l,d+="/"+n;let h="";h=t?i+t:i+s+"/"+d;let u=new XMLHttpRequest;r&&console.log("Fetching data from: "+h),u.open("GET",h,!0),u.onload=function(t){if(4===u.readyState)if(200===u.status){let t=JSON.parse(u.responseText);e.html_element.dataset.loadedData=u.responseText,r&&(console.log(t),console.log("Load and save finished."))}else console.error(u.statusText)},u.onerror=function(e){console.error("Fetching data from bloodmallet.com encountered an error, ",e)},u.send(null)}function c(e){return JSON.parse(e.html_element.dataset.loadedData)}function h(e,t,o,a){r&&console.log("update_chart");e.chart_id;let l=e.data_type,i=e.fight_style,d=e.wow_class,y=e.wow_spec,A=e.limit,E=e.chart_engine,L=!1;try{L=c(e)}catch(l){return void(a<30&&setTimeout(h,200,e,t,o,a+1))}if(!0===L.error)return function(e,t){let o=e;o.innerHTML="";let a=document.createElement("p");a.innerText="An error occured during simulation.",o.appendChild(a);let l=document.createElement("ul"),r=document.createElement("li");r.textContent="Title: "+(t.title?t.title:"~"),l.appendChild(r);let i=document.createElement("li");i.textContent="Spec: "+t.wow_spec+" "+t.wow_class,l.appendChild(i);let n=document.createElement("li");n.textContent="Type: "+t.simulation_type,l.appendChild(n);let s=document.createElement("li");s.textContent="Fight style: "+t.fight_style,l.appendChild(s);let d=document.createElement("li");d.textContent="ID: "+t.id,l.appendChild(d);let c=document.createElement("li");c.textContent="Custom profile:",l.appendChild(c),c.appendChild(document.createElement("br"));let h=document.createElement("textarea");h.readOnly=!0,h.value=t.custom_profile,h.placeholder="No custom profile",h.style.width="100%",c.appendChild(h);let u=document.createElement("li");u.textContent="Log:",l.appendChild(u),u.appendChild(document.createElement("br"));let g=document.createElement("textarea");g.readOnly=!0,g.value=t.log,g.placeholder="No log available",g.style.width="100%",u.appendChild(g),o.appendChild(l)}(t,L);if(d=L.simc_settings.class,y=L.simc_settings.spec,i=L.simc_settings.fight_style,e.data_type=l=L.data_type,function(e,t){if(!["bloodmallet.com","127.0.0.1:8000"].includes(window.location.host))return;r&&console.log("provide_meta_data");["trinkets","covenants","conduits","soulbind_nodes"].includes(e.data_type)&&(document.getElementById("value_style_switch").hidden=!1);["soulbinds"].includes(e.data_type)&&(document.getElementById("chart_options").hidden=!1);document.getElementById("meta-info").hidden=!1;for(let e in t.simc_settings){let o=document.createTextNode(t.simc_settings[e]),a=document.getElementById("c_"+e);a.innerText="",a.appendChild(o)}let o=document.createElement("a");o.href="https://github.com/simulationcraft/simc/commit/"+t.simc_settings.simc_hash,o.innerText=t.simc_settings.simc_hash.substring(0,7);let a=document.getElementById("c_simc_hash");a.innerText="",a.appendChild(o);for(let e in t.profile.character)try{let o=document.getElementById("c_"+e);o.innerHTML="";let a=document.createTextNode(t.profile.character[e].split(" ").map(e=>e[0].toUpperCase()+e.substring(1)).join(" "));o.appendChild(a)}catch(e){}const l=void 0!==t.profile.character.talents?t.profile.character.talents:"0000000";let i=document.getElementById("c_talents");i.innerHTML="";for(let o=0;o<l.length;o++){const a=l[o];let r=document.createElement("a");r.href="",r.href="https://"+("en"===e.language?"www":e.language)+".wowhead.com/";try{r.href+="spell="+t.talent_data[parseInt(o)+1][parseInt(a)].spell_id}catch(e){continue}r.dataset.whIconSize="medium",i.appendChild(r)}for(let o in t.profile.items){let a=document.createElement("a");a.href="",a.href="https://"+("en"===e.language?"www":e.language)+".wowhead.com/",a.href+="item="+t.profile.items[o].id;let l=[];try{l.push("bonus="+t.profile.items[o].bonus_id.split("/").join(":"))}catch(e){}try{t.profile.items[o].hasOwnProperty("ilevel")&&l.push("ilvl="+t.profile.items[o].ilevel)}catch(e){}l.length>0&&(a.href+="?"+l.join("&")),a.dataset.whIconSize="medium";let r=document.getElementById("c_"+o);r.innerHTML="",r.appendChild(a)}"talents"===e.data_type&&(document.getElementById("talent-warning").hidden=!1,function(e,t){r&&console.log("build_talent_table");document.getElementById("talent-table").hidden=!1;let o=[];for(let e=1;e<8;e++)for(let t=1;t<4;t++)o.push(e.toString()+t.toString());for(let a of o){let o=document.getElementById(a);try{let l=document.createElement("h5"),i=t.talent_data[a.slice(0,1)][a.slice(1,2)];l.innerHTML=w(e,i.name,a,t),o.innerHTML="",o.appendChild(l),o.appendChild(f("Mean",k(a,t))),o.appendChild(f("Min",v(a,t)[1],v(a,t)[0])),o.appendChild(f("Max",C(a,t)[1],C(a,t)[0]));let n=b(a,t),s=n.slice(0,a.slice(0,1)-1)+"0"+n.slice(a.slice(0,1),8),d=t.data[n],c=t.data[s];o.appendChild(f("Max dps",T(c,d),n)),n=b(a,t);let h=T(t.data[t.sorted_data_keys[0]],t.data[n]);o.appendChild(f("Max dps minus global best",h,n))}catch(e){o.innerHTML="-",r&&console.warn(e)}}$(function(){$('[data-toggle="tooltip"]').tooltip()})}(e,t));if("soulbinds"===e.data_type){let o=document.getElementById("post_chart");o.hidden=!1,o.innerHTML="",Object.keys(t.covenant_ids).forEach(a=>{const l=t.covenant_ids[a];let r=document.createElement("h3");r.appendChild(document.createTextNode(x(a,t))),o.appendChild(r);let i=0;for(const a of t.sorted_data_keys[t.simulated_steps[0]])if(t.covenant_mapping[a].indexOf(l)>-1){i+=1;let l=document.createElement("h4");l.appendChild(document.createTextNode(i+". "+x(a,t))),l.classList+="ml-3",l.id=a,o.appendChild(l);let r=document.createElement("p");r.classList+="ml-5";let s=[];for(const o of t.soul_bind_paths[t.simulated_steps[0]][a])if(t.data.hasOwnProperty(o)){let a=document.createElement("a");a.href="https://"+("en"===e.language?"www":e.language)+".wowhead.com/",t.hasOwnProperty("spell_ids")&&t.spell_ids.hasOwnProperty(o)&&(a.href+="spell="+t.spell_ids[o]+"/"+_(o)),a.appendChild(document.createTextNode(t.translations[o][n[e.language]])),s.push(a)}for(let e=0;e<s.length;e++)0!==e&&r.appendChild(document.createTextNode(", ")),r.appendChild(s[e]);o.appendChild(r)}})}try{$WowheadPower.refreshLinks()}catch(e){}}(e,L),"secondary_distributions"===l)return function(e,t,o){r&&console.log("update_secondary_distribution_chart");let a=t.id,l=(e.chart_id,e.fight_style),i=e.wow_class,n=e.wow_spec,s=(e.chart_engine,!1);s=c(e),i=s.simc_settings.class,n=s.simc_settings.spec,l=s.simc_settings.fight_style;let d=m(e),h=!1;if("highcharts"==e.chart_engine)try{h=Highcharts.chart(a,d)}catch(e){return console.log("When trying to create a highcharts chart the following error occured. Did you include the necessary Highcharts scripts?"),void console.log(e)}else if("highcharts_old"==e.chart_engine)try{let e=d;e.chart.renderTo=a,h=new Highcharts.Chart(e)}catch(e){return console.log("When trying to create a highcharts_old chart the following error occured. Did you include the necessary Highcharts scripts?"),void console.log(e)}o=void 0,o=h;let u=void 0;u=Object.keys(s.data)[0];let p=s.data[u][s.sorted_data_keys[u][0]],_=s.data[u][s.sorted_data_keys[u][s.sorted_data_keys[u].length-1]],f=g(100,0,100),y=g(0,0,100),b={name:Intl.NumberFormat().format(p)+" DPS",color:"rgb("+f[0]+","+f[1]+","+f[2]+")",data:[]};for(let t of Object.keys(s.data[u])){let o=s.data[u][t],a=g(o,_,p),l=1,r="#232227",i=5;p===o&&(l=3,i=8,r=e.font_color);let n=void 0;if(t.indexOf("70")>-1)switch(n={enabled:!0,allowOverlap:!0},t.indexOf("70")){case 0:n.format="Crit",n.verticalAlign="top";break;case 3:n.format="Haste";break;case 6:n.format="Mastery",n.verticalAlign="top";break;case 9:n.format="Versatility",n.verticalAlign="top"}const d=s.secondary_sum;let c=parseInt(t.split("_")[0]),h=parseInt(t.split("_")[1]),m=parseInt(t.split("_")[2]),f=parseInt(t.split("_")[3]);b.data.push({x:Math.sqrt(3)/2*(c+1/3*h),y:Math.sqrt(2/3)*h,z:m+.5*c+.5*h,name:t,color:"rgb("+a[0]+","+a[1]+","+a[2]+")",dps:o,dps_max:p,dps_min:_,stat_crit:c*d/100,stat_haste:h*d/100,stat_mastery:m*d/100,stat_vers:f*d/100,stat_sum:d,marker:{radius:i,lineColor:r,lineWidth:l},dataLabels:n})}for(;o.series[0];)o.series[0].remove(!1);o.addSeries(b,!1),o.addSeries({name:Intl.NumberFormat().format(_)+" DPS",color:"rgb("+y[0]+","+y[1]+","+y[2]+")"},!1);let w=s.timestamp,x=w.split("-")[0],v=w.split("-")[1],C=w.split("-")[2].split(" ")[0],k=w.split(" ")[1].split(":")[0],T=w.split(":")[1],A="Last updated ",E=new Date-new Date(Date.UTC(x,v-1,C,k,T)),L=Math.floor(E/24/3600/1e3);L>0&&(A+=`${L}d `);let z=Math.floor(E/3600/1e3)-24*L;A+=`${z}h ago`,o.redraw(),function(e){function t(t){var a=(t=o.pointer.normalize(t)).chartX,l=t.chartY,r=o.options.chart.options3d.alpha,i=o.options.chart.options3d.beta,n=5;function s(e){e=o.pointer.normalize(e),o.update({chart:{options3d:{alpha:r+(e.chartY-l)/n,beta:i+(a-e.chartX)/n}}},void 0,void 0,!1)}o.unbindDragMouse=e.addEvent(document,"mousemove",s),o.unbindDragTouch=e.addEvent(document,"touchmove",s),e.addEvent(document,"mouseup",o.unbindDragMouse),e.addEvent(document,"touchend",o.unbindDragTouch)}e.addEvent(o.container,"mousedown",t),e.addEvent(o.container,"touchstart",t)}(Highcharts)}(e,t,o);"azerite_traits"===L.data_type?-1===l.indexOf("azerite_items")&&(l="azerite_traits_stacking"):l=L.data_type;const z=L;let M,I;if(l.indexOf("azerite_traits")>-1)if("azerite_traits_stacking"===l)"all"===e.azerite_tier?M=z.sorted_data_keys_2.slice(0,A):"1"===e.azerite_tier||"3"===e.azerite_tier?M=z.sorted_azerite_tier_3_trait_stacking.slice(0,A):"2"===e.azerite_tier&&(M=z.sorted_azerite_tier_2_trait_stacking.slice(0,A)),I=z.data.baseline[z.simulated_steps[0]];else{if("azerite_traits_itemlevel"!==l)return void console.log("Chart found, but unknown data-type detected.");"all"===e.azerite_tier?M=z.sorted_data_keys.slice(0,A):"1"===e.azerite_tier||"3"===e.azerite_tier?M=z.sorted_azerite_tier_3_itemlevel.slice(0,A):"2"===e.azerite_tier&&(M=z.sorted_azerite_tier_2_itemlevel.slice(0,A)),I=z.data.baseline[z.simulated_steps[z.simulated_steps.length-1]]}else M="soulbinds"===l?"nodes"===e.chart_mode?z["sorted_data_keys_"+_(e.covenant).replace("-","_")+"_"+e.conduit_rank].slice(0,A):z.sorted_data_keys[e.conduit_rank].slice(0,A):z.sorted_data_keys.slice(0,A),I=["races","talents"].includes(l)?0:["legendaries","soulbind_nodes","soulbinds","covenants"].includes(l)?z.data.baseline:z.data.baseline[z.simulated_steps[z.simulated_steps.length-1]];for(r&&(console.log(M),console.log("Baseline dps: "+I)),o.setTitle({text:z.title},{text:z.subtitle},!1);o.series[0];)o.series[0].remove(!1);let O=void 0;O="talents"===l?M.map(t=>{let o=[];for(let a=0;a<t.length;a++)o.push(p(e,(a+1).toString()+t[a],z));return o.join("")}):M.map(t=>p(e,t,z)),r&&console.log(O),"highcharts"==E?o.update({xAxis:{categories:O}},!1):"highcharts_old"==E&&o.xAxis[0].setCategories(O,!1);let S=[];if("azerite_traits_stacking"==l){let e=z.simulated_steps[0].replace("1_","");S.push("3_"+e),S.push("2_"+e),S.push("1_"+e)}else S="soulbinds"==l&&"soulbinds"===e.chart_mode?void 0:z.simulated_steps;if(r&&console.log("simulated_steps: "+S),S){let t={};for(const o in z.data)if(z.data.hasOwnProperty(o)){const a=z.data[o];t[o]={};let r=I;"conduits"===l?r=z.data.baseline[z.covenant_mapping[o]]:"soulbinds"===l&&"nodes"===e.chart_mode&&(r=z.data.baseline[e.covenant]);for(let l=S.length-1;l>=0;l--){const i=S[l];let n=a.hasOwnProperty(e.covenant)?a[e.covenant]:a;Number.isInteger(n)?(t[o][i]=n-r,r=n):n.hasOwnProperty(i)?(t[o][i]=n[i]-r,r=n[i]):t[o][i]=0}}for(const a of S){let r=[];for(let o=0;o<M.length;o++){const l=M[o];r.push(u(e,t[l][a],I))}let i=a;["azerite_items_chest","azerite_items_head","azerite_items_shoulders","azerite_traits_itemlevel"].indexOf(l)>-1?i=a.split("_")[1]:"azerite_traits_stacking"===l&&(i=a.split("_")[0]),o.addSeries({data:r,name:i},!1)}}else if(["legendaries","soulbind_nodes","covenants"].includes(l)){var H=[];for(let t=0;t<M.length;t++){let o=M[t],a=z.data[o]-I;H.push(u(e,a,I))}o.addSeries({data:H,name:"Data",showInLegend:!1},!1)}else if(["soulbinds"].includes(l)&&"soulbinds"===e.chart_mode)for(const t of Object.keys(s).sort().reverse()){const a=s[t].id;let l=[];for(let t=0;t<M.length;t++){let o=M[t],r=0;z.covenant_mapping[o][0]===a&&(r=z.data[o][e.conduit_rank]),l.push(r)}o.addSeries({data:l,name:x(t,z),showInLegend:!0,color:s[t].color},!1)}else{H=[];for(let t=0;t<M.length;t++){let o=M[t],a=z.data[o];"soulbinds"===l&&(a=z.data[o][e.conduit_rank]),H.push(a)}o.addSeries({data:H,name:"DPS",showInLegend:!1},!1)}["trinkets","azerite_items_chest","azerite_items_head","azerite_items_shoulders","azerite_traits_itemlevel"].indexOf(l)>-1?o.legend.title.attr({text:"Itemlevel"}):"races"===l?o.legend.title.attr({text:""}):"azerite_traits_stacking"===l?o.legend.title.attr({text:"Trait count"}):"soulbinds"===l&&"nodes"===e.chart_mode&&o.legend.title.attr({text:"Conduit Rank"}),o.redraw(),"highcharts_old"==E&&o.reflow(),t.style.height=200+30*M.length+"px","highcharts"==E&&o.setSize(t.style.width,t.style.height),"wowdb"==e.tooltip_engine&&setTimeout(function(){!function(e){r&&console.log("readd_wowdb_tooltips");try{CurseTips["wowdb-tooltip"].watchElements(document.getElementById(e).getElementsByTagName("a"))}catch(e){console.log("Setting wowdb (CurseTips) tooltips failed. Error: ",e)}}(t.id)},1)}function u(e,t,o){return"absolute"===e.value_style?t:"relative"===e.value_style?Math.round(1e4*t/o)/100:void console.error("Unknown value-style",e.value_style)}function g(e,t,o){r&&console.log("create_color");let a=[0,255,255],l=[255,255,0],i=[255,0,0],n=0,s=0;for(let e=0;e<3;e++)n+=Math.abs(i[e]-l[e]),s+=Math.abs(l[e]-a[e]);let d=t+(o-t)*(s/(s+n));if(e>=d){let t=(e-d)/(o-d);return[Math.floor(i[0]*t+l[0]*(1-t)),Math.floor(i[1]*t+l[1]*(1-t)),Math.floor(i[2]*t+l[2]*(1-t))]}{let o=(e-t)/(d-t);return[Math.floor(l[0]*o+a[0]*(1-o)),Math.floor(l[1]*o+a[1]*(1-o)),Math.floor(l[2]*o+a[2]*(1-o))]}}function p(e,t,o){if(r&&(console.log("get_category_name"),console.log(t)),"wowhead"!=e.tooltip_engine&&"wowdb"!=e.tooltip_engine)try{return o.translations[t][n[e.language]]}catch(a){return o.languages[t][n[e.language]]}if(["races"].includes(e.data_type))try{return o.translations[t][n[e.language]]}catch(a){return o.languages[t][n[e.language]]}if(["soulbinds"].includes(e.data_type)&&"soulbinds"===e.chart_mode){let a='<a href="#'+t+'">';return a+=o.translations[t][n[e.language]],a+="</a>"}if("wowhead"==e.tooltip_engine){let a=document.createElement("a");if(a.href="https://"+("en"===e.language?"www":e.language)+".wowhead.com/",o.hasOwnProperty("item_ids")&&o.item_ids.hasOwnProperty(t)){if(a.href+="item="+o.item_ids[t]+"/"+_(t),o.hasOwnProperty("class_id")&&o.hasOwnProperty("used_azerite_traits_per_item")){a.href+="?azerite-powers="+o.class_id;for(let e=0;e<o.used_azerite_traits_per_item[t].length;e++){const l=o.used_azerite_traits_per_item[t][e];a.href+=":"+l.id}}let e=o.simulated_steps[o.simulated_steps.length-1];"string"==typeof e&&e.indexOf("_")>-1&&(e=e.split("_")[1]),a.href+="&ilvl="+e}else if(o.hasOwnProperty("spell_ids")&&o.spell_ids.hasOwnProperty(t))a.href+="spell="+o.spell_ids[t]+"/"+_(t);else if("talents"===e.data_type){if("0"===t[1])return t[1];a.href+="spell="+o.talent_data[t[0]][t[1]].spell_id}if("talents"===e.data_type)a.appendChild(document.createTextNode(t[1]));else try{a.appendChild(document.createTextNode(o.translations[t][n[e.language]]))}catch(l){try{a.appendChild(document.createTextNode(o.languages[t][n[e.language]]))}catch(e){a.appendChild(document.createTextNode(t))}}return a.outerHTML}if("wowdb"==e.tooltip_engine){let a=document.createElement("a");a.href="http://www.wowdb.com/";try{a.href+="items/"+o.item_ids[t]}catch(e){r&&(console.log(e),console.log("We're probably looking at a spell."))}if(a.href.indexOf("items")>-1){let e=o.simulated_steps[o.simulated_steps.length-1];if("string"==typeof e&&e.indexOf("_")>-1&&(e=e.split("_")[1]),a.href+="?itemLevel="+e,o.hasOwnProperty("class_id")&&o.hasOwnProperty("used_azerite_traits_per_item")){a.href+="&azerite=",a.href+=o.class_id+":0";for(let e=0;e<o.used_azerite_traits_per_item[t].length;e++){const l=o.used_azerite_traits_per_item[t][e];a.href+=":"+l.id}}}try{a.href+="spells/"+o.spell_ids[t]}catch(e){r&&(console.log(e),console.log("We're probably looking at an item."))}if("talents"===e.data_type){if("0"===t[1])return t[1];a.href+="spells/"+o.talent_data[t[0]][t[1]].spell_id}a.dataset.tooltipHref=a.href;let l=void 0;if("talents"===e.data_type)l=t[1];else try{l=o.translations[t][n[e.language]]}catch(a){try{l=o.languages[t][n[e.language]]}catch(e){l=t}}return a.appendChild(document.createTextNode(l)),a.outerHTML}}function _(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function m(i){if(r&&console.log("update_chart_style"),"highcharts"==i.chart_engine||"highcharts_old"==i.chart_engine){if("secondary_distributions"===i.data_type)return{chart:{renderTo:"scatter_plot_chart",type:"scatter3d",backgroundColor:null,animation:!1,height:800,width:800,options3d:{enabled:!0,alpha:10,beta:30,depth:800,fitToPlot:!1}},legend:{enabled:!0,backgroundColor:i.background_color,borderColor:i.font_color,borderWidth:1,align:"right",verticalAlign:"middle",layout:"vertical",itemStyle:{color:i.font_color},itemHoverStyle:{color:i.font_color}},plotOptions:{series:{dataLabels:{allowOverlap:!0,style:{color:i.font_color,fontSize:i.font_size,fontWeight:"400",textOutline:""}},events:{legendItemClick:function(){return!1}}}},series:[],title:{text:"",useHTML:!0,style:{color:i.font_color}},subtitle:{text:"",useHTML:!0,style:{color:i.font_color,fontSize:i.font_size}},tooltip:{headerFormat:"",pointFormatter:function(){return'<table class="">                <thead>                  <tr>                    <th scope="col"></th>                    <th scope="col">Absolute</th>                    <th scope="col">Relative</th>                  </tr>                </thead>                <tbody>                  <tr>                    <th scope="row">DPS</th>                    <td>'+Intl.NumberFormat().format(this.dps)+"</td>                    <td>"+Math.round(this.dps/this.dps_max*1e4)/100+'%</td>                  </tr>                  <tr>                    <th scope="row">Crit</th>                    <td>'+Intl.NumberFormat().format(this.stat_crit)+"</td>                    <td>"+this.name.split("_")[0]+'%</td>                  </tr>                  <tr>                    <th scope="row">Haste</th>                    <td>'+Intl.NumberFormat().format(this.stat_haste)+"</td>                    <td>"+this.name.split("_")[1]+'%</td>                  </tr>                  <tr>                    <th scope="row">Mastery</th>                    <td>'+Intl.NumberFormat().format(this.stat_mastery)+"</td>                    <td>"+this.name.split("_")[2]+'%</td>                  </tr>                  <tr>                    <th scope="row">Versatility</th>                    <td>'+Intl.NumberFormat().format(this.stat_vers)+"</td>                    <td>"+this.name.split("_")[3]+"%</td>                  </tr>                </tbody>              </table>"},useHTML:!0,borderColor:i.background_color},xAxis:{min:0,max:80,tickInterval:20,startOnTick:!0,endOnTick:!0,title:"",labels:{enabled:!1},gridLineWidth:1,gridLineColor:i.axis_color},yAxis:{min:-10,max:70,tickInterval:20,startOnTick:!0,endOnTick:!0,title:"",labels:{enabled:!1},gridLineWidth:1,gridLineColor:i.axis_color},zAxis:{min:10,max:90,tickInterval:20,startOnTick:!0,endOnTick:!0,title:"",labels:{enabled:!1},reversed:!0,gridLineWidth:1,gridLineColor:i.axis_color}};let r=i.background_color,n=i.axis_color,s=i.font_color,d="https://bloodmallet.com/";void 0!==i.chart_id?d+="chart/"+i.chart_id:void 0!==i.wow_class&&void 0!==i.wow_spec&&(d+="#"+i.wow_class+"_"+i.wow_spec);let c={chart:{type:"bar",backgroundColor:t,style:{fontFamily:'-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"'}},colors:e,credits:{href:d,text:"bloodmallet",style:{fontSize:l}},legend:{align:"right",backgroundColor:t,borderColor:a,borderWidth:1,floating:!1,itemMarginBottom:3,itemMarginTop:0,layout:"vertical",reversed:!0,shadow:!1,verticalAlign:"middle",x:0,y:0,itemStyle:{color:o},itemHoverStyle:{color:o},title:{text:" ",style:{color:o}},symbolRadius:0},plotOptions:{series:{stacking:"normal",borderColor:t,events:{legendItemClick:function(){return!1}},style:{textOutline:!1,fontSize:l}}},series:[],title:{text:"Loading data...",useHTML:!0,style:{color:o,fontSize:l}},subtitle:{text:'...from <a href="https://bloodmallet.com">bloodmallet</a>',useHTML:!0,style:{color:o,fontSize:l}},tooltip:{headerFormat:"<b>{point.x}</b>",shared:!0,backgroundColor:t,borderColor:a,style:{color:o,fontSize:l},useHTML:!0},xAxis:{categories:[],labels:{useHTML:!0,style:{color:o,fontSize:l}},gridLineWidth:0,gridLineColor:a,lineColor:a,tickColor:a},yAxis:[{labels:{style:{color:a}},min:0,stackLabels:{enabled:!0,formatter:function(){return Intl.NumberFormat().format(this.total)},style:{color:o,textOutline:!1,fontSize:l,fontWeight:"normal"}},title:{text:"absolute"===i.value_style?"Δ Damage per second":"% Damage per second",style:{color:a}},gridLineWidth:1,gridLineColor:a},{linkedTo:0,opposite:!0,labels:{style:{color:a}},min:0,stackLabels:{enabled:!0,formatter:function(){return Intl.NumberFormat().format(this.total)},style:{color:o,textOutline:!1,fontSize:l,fontWeight:"normal"}},title:{text:"absolute"===i.value_style?"Δ Damage per second":"% Damage per second",style:{color:a}},gridLineWidth:1,gridLineColor:a}]};return c.chart.backgroundColor=r,c.legend.backgroundColor=r,c.legend.borderColor=n,c.legend.itemStyle.color=s,c.legend.itemHoverStyle.color=s,c.title.style.color=s,c.subtitle.style.color=s,c.tooltip.formatter=function(){let e=document.createElement("div");e.style.margin="-4px -7px -7px -7px",e.style.padding="3px 3px 6px 3px",e.style.backgroundColor="transparent"!==r?r:t,"highcharts_old"===i.chart_engine&&(e.style.margin="-7px");let o=document.createElement("div");e.appendChild(o),o.style.marginLeft="9px",o.style.marginRight="9px",o.style.marginBottom="6px",o.style.fontWeight="700",o.innerHTML=this.x;let a=0;for(var l=this.points.length-1;l>=0;l--)if(a+=this.points[l].y,0!==this.points[l].y){let t=document.createElement("div");e.appendChild(t);let o=document.createElement("span");t.appendChild(o),o.style.marginLeft="9px",o.style.borderLeft="9px solid "+this.points[l].series.color,o.style.paddingLeft="4px",Number.isInteger(this.points[l].series.name)&&o.appendChild(document.createTextNode(this.points[l].series.name+":")),t.appendChild(document.createTextNode("  "+Intl.NumberFormat().format(a)+("relative"===i.value_style?"%":"")))}return e.outerHTML},c.tooltip.backgroundColor="transparent"!==r?r:t,c.tooltip.borderColor=n,c.tooltip.style.color=s,c.xAxis.labels.style.color=s,c.xAxis.gridLineColor=n,c.xAxis.lineColor=n,c.xAxis.tickColor=n,c.yAxis[0].labels.style.color=n,c.yAxis[0].stackLabels.style.color=s,c.yAxis[0].gridLineColor=n,c.yAxis[0].lineColor=n,c.yAxis[0].tickColor=n,c.yAxis[0].title.style.color=n,c.yAxis[1].labels.style.color=n,c.yAxis[1].stackLabels.style.color=s,c.yAxis[1].gridLineColor=n,c.yAxis[1].lineColor=n,c.yAxis[1].tickColor=n,c.yAxis[1].title.style.color=n,c.credits.style.color=s,c}}function f(e,t,o){let a=document.createElement("div");a.innerHTML=e+": ";let l=document.createElement("span");if(l.innerHTML=t+"%",l.classList+=y(t>=0?t:3-t),void 0!==o){l.title="Talent combination: "+o,l.setAttribute("data-toggle","tooltip"),l.setAttribute("data-placement","bottom");let e=document.createElement("span");e.classList+="priest-color",e.innerHTML=" (?)",l.appendChild(e)}return a.appendChild(l),a}function y(e){return r&&console.log("get_value_color"),e<5?"mage-color":e>10&&e<=12?"druid-color":e>12?"death_knight-color":"monk-color"}function b(e,t){for(let o of t.sorted_data_keys)if(o[e.slice(0,1)-1]===e.slice(1,2))return o;return!1}function w(e,t,o,a){let l='<a href="https://';return"en"===e.language||"EN"===e.language?l+="www":l+=e.language.toLowerCase(),l+=".wowhead.com/spell=",l+=a.talent_data[o.slice(0,1)][o.slice(1,2)].spell_id,l+='"',l+=">",l+=x(t,a),l+="</a>"}function x(e,t){r&&console.log("get_translated_name "+e);let o={"zh-hans":"cn_CN",en:"en_US",de:"de_DE",es:"es_ES",fr:"fr_FR",it:"it_IT",ko:"ko_KR",pt:"pt_BR",ru:"ru_RU"},a="";try{a=t.translations[e][o[language]]}catch(t){r&&(console.log(`No translation for ${e} found.`),console.log(t)),a=e}return r&&console.log("Translated name: "+a),a}function v(e,t){let o=e.slice(0,1),a=e.slice(1,2),l=100,r="";for(let e of t.sorted_data_keys)if(e[o-1]===a){let a=t.data[e],i=t.data[e.slice(0,o-1)+"0"+e.slice(o,8)];l>T(i,a)&&(l=T(i,a),r=e)}return[r,l]}function C(e,t){let o=e.slice(0,1),a=e.slice(1,2),l=-100,r="";for(let e of t.sorted_data_keys)if(e[o-1]===a){let a=t.data[e],i=t.data[e.slice(0,o-1)+"0"+e.slice(o,8)];l<T(i,a)&&(l=T(i,a),r=e)}return[r,l]}function k(e,t){r&&console.log("get_average_gain");let o=[];for(let a of t.sorted_data_keys)a[e.slice(0,1)-1]===e.slice(1,2)&&o.push(a);let a=0;for(let l of o){let o=t.data[l];a+=T(t.data[l.slice(0,e.slice(0,1)-1)+"0"+l.slice(e.slice(0,1),8)],o)}return Math.round(a/o.length*100)/100}function T(e,t){return r&&console.log("get_percentage_gain"),Math.round(100*(100*t/e-100))/100}this.init_charts=new function(){r&&console.log("init_charts");let e=document.querySelectorAll("div.bloodmallet_chart"),l=[];for(let t=0;t<e.length;t++){const o=e[t];if(l.indexOf(o.id)>-1)return void console.error("Multiple Elements use the same ID ('"+o.id+"'). Aborting bloodmallet_chart_import.js.");l.push(o.id)}for(let l=0;l<e.length;l++){let i=void 0;try{i=e[l].id}catch(e){return void console.error("Each .bloodmallet_chart needs an ID. Aborting bloodmallet_chart_import.js.")}const n=document.getElementById(e[l].id);if(n){let e={chart_id:void 0,wow_class:void 0,wow_spec:void 0,data_type:"trinkets",azerite_tier:"all",conduit_rank:"7",fight_style:"castingpatchwerk",chart_mode:"soulbinds",covenant:"Kyrian",axis_color:a,background_color:t,font_color:o,limit:7,chart_engine:"highcharts",tooltip_engine:"wowhead",language:"en",value_style:"absolute",html_element:n};try{void 0!==bloodmallet.style.axis_color&&(e.axis_color=bloodmallet.style.axis_color),void 0!==bloodmallet.style.background_color&&(e.background_color=bloodmallet.style.background_color),void 0!==bloodmallet.style.font_color&&(e.font_color=bloodmallet.style.font_color),void 0!==bloodmallet.settings.entries&&(e.limit=bloodmallet.settings.entries),void 0!==bloodmallet.settings.chart_engine&&(e.chart_engine=bloodmallet.settings.chart_engine),void 0!==bloodmallet.settings.tooltip_engine&&(e.tooltip_engine=bloodmallet.settings.tooltip_engine),void 0!==bloodmallet.settings.language&&(e.language=bloodmallet.settings.language),void 0!==bloodmallet.settings.value_style&&(e.value_style=bloodmallet.settings.value_style)}catch(e){r&&console.log("Applying page wide settings failed or no page wide settings were found.")}n.getAttribute("data-entries")&&(e.limit=n.getAttribute("data-entries")),n.getAttribute("data-fight-style")&&(e.fight_style=n.getAttribute("data-fight-style")),n.getAttribute("data-type")&&(e.data_type=n.getAttribute("data-type")),n.getAttribute("data-chart-mode")&&(e.chart_mode=n.getAttribute("data-chart-mode")),n.getAttribute("data-covenant")&&(e.covenant=n.getAttribute("data-covenant")),n.getAttribute("data-azerite-tier")&&(e.azerite_tier=n.getAttribute("data-azerite-tier")),n.getAttribute("data-conduit-rank")&&(e.conduit_rank=n.getAttribute("data-conduit-rank")),n.getAttribute("data-background-color")&&(e.background_color=n.getAttribute("data-background-color")),n.getAttribute("data-font-color")&&(e.font_color=n.getAttribute("data-font-color")),n.getAttribute("data-axis-color")&&(e.axis_color=n.getAttribute("data-axis-color")),n.getAttribute("data-tooltip-engine")&&(e.tooltip_engine=n.getAttribute("data-tooltip-engine")),n.getAttribute("data-chart-engine")&&(e.chart_engine=n.getAttribute("data-chart-engine")),n.getAttribute("data-language")&&(e.language=n.getAttribute("data-language")),n.getAttribute("data-value-style")&&(e.value_style=n.getAttribute("data-value-style"));let l=!0;n.getAttribute("data-chart-id")?e.chart_id=n.getAttribute("data-chart-id"):(n.getAttribute("data-wow-class")||(console.error("Required 'data-chart-id' or 'data-wow-class' attribute wasn't found in "+i+"."),l=!1),e.wow_class=n.getAttribute("data-wow-class"),n.getAttribute("data-wow-spec")||(console.error("Required 'data-chart-id' or 'data-wow-spec' attribute wasn't found in "+i+"."),l=!1),e.wow_spec=n.getAttribute("data-wow-spec"));let s=m(e),c=!1;if("highcharts"==e.chart_engine)try{c=Highcharts.chart(i,s)}catch(e){return console.log("When trying to create a highcharts chart the following error occured. Did you include the necessary Highcharts scripts?"),void console.log(e)}else if("highcharts_old"==e.chart_engine)try{let e=s;e.chart.renderTo=i,c=new Highcharts.Chart(e)}catch(e){return console.log("When trying to create a highcharts_old chart the following error occured. Did you include the necessary Highcharts scripts?"),void console.log(e)}l?d(e):c.setTitle({text:"Wrong chart setup"},{text:"Missing 'data-chart-id', 'data-wow-class' or 'data-wow-spec'. See <a href=\"https://github.com/Bloodmallet/bloodmallet_web_frontend/wiki/How-to-import-charts\">wiki</a>"}),setTimeout(h,1,e,n,c,0)}}}}document.addEventListener("DOMContentLoaded",function(){bloodmallet_chart_import()});