function bloodmallet_chart_import(){const e=["#7cb5ec","#d9d9df","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"],t="#343a40",o="#f8f9fa",l="#828282",a="1.1rem",n=!1,i="https://bloodmallet.com/chart/get/",r={cn:"cn_CN",en:"en_US",de:"de_DE",es:"es_ES",fr:"fr_FR",it:"it_IT",ko:"ko_KR",pt:"pt_BR",ru:"ru_RU","zh-hans":"cn_CN"},s={Kyrian:{id:1,color:"#69ccf0"},Venthyr:{id:2,color:"#c41f3b"},"Night Fae":{id:3,color:"#a330c9"},Necrolord:{id:4,color:"#abd473"}},d={1:145,2:158,3:171,4:184,5:200,6:213,7:226,8:239,9:252,10:265,11:278},c={unholy:"#abd473",frost:"#69ccf0",blood:"#c41f3b"},h="Î” Damage per second",u="% Damage per second";function p(e){n&&console.log("load_data");let t=e.chart_id,o=e.data_type,l=e.fight_style,a=e.wow_class,r=e.wow_spec;try{if(m(e))return}catch(e){n&&(console.log("Data needs to be loaded."),console.log(e))}let s=l;s+="/"+a,s+="/"+r;let d="";d=t?i+t:i+o+"/"+s;let c=new XMLHttpRequest;n&&console.log("Fetching data from: "+d),c.open("GET",d,!0),c.onload=function(t){if(4===c.readyState)if(200===c.status){let t=JSON.parse(c.responseText);e.html_element.dataset.loadedData=c.responseText,n&&(console.log(t),console.log("Load and save finished."))}else console.error(c.statusText)},c.onerror=function(e){console.error("Fetching data from bloodmallet.com encountered an error, ",e)},c.send(null)}function m(e){return JSON.parse(e.html_element.dataset.loadedData)}function g(e,t,o,l){n&&console.log("update_chart");let a=e.data_type,i=e.limit,r=e.chart_engine,u=!1;try{u=m(e)}catch(a){return void(l<30&&setTimeout(g,200,e,t,o,l+1))}if(!0===u.error||"error"===u.status)return function(e,t){let o=e;if(o.innerHTML="","error"===t.status){let e=document.createElement("p");e.innerText=t.message,o.appendChild(e)}else{let e=document.createElement("p");e.innerText="An error occured during simulation.",o.appendChild(e);let l=document.createElement("ul"),a=document.createElement("li");a.textContent="Title: "+(t.title?t.title:"~"),l.appendChild(a);let n=document.createElement("li");n.textContent="Spec: "+t.wow_spec+" "+t.wow_class,l.appendChild(n);let i=document.createElement("li");i.textContent="Type: "+t.simulation_type,l.appendChild(i);let r=document.createElement("li");r.textContent="Fight style: "+t.fight_style,l.appendChild(r);let s=document.createElement("li");s.textContent="ID: "+t.id,l.appendChild(s);let d=document.createElement("li");d.textContent="Custom profile:",l.appendChild(d),d.appendChild(document.createElement("br"));let c=document.createElement("textarea");c.readOnly=!0,c.value=t.custom_profile,c.placeholder="No custom profile",c.style.width="100%",d.appendChild(c);let h=document.createElement("li");h.textContent="Log:",l.appendChild(h),h.appendChild(document.createElement("br"));let u=document.createElement("textarea");u.readOnly=!0,u.value=t.log,u.placeholder="No log available",u.style.width="100%",h.appendChild(u),o.appendChild(l)}}(t,u);if(wow_class=u.simc_settings.class,wow_spec=u.simc_settings.spec,fight_style=u.simc_settings.fight_style,e.data_type=a=u.data_type,"soulbinds"===a&&(e.conduit_rank=Math.max(...u.simulated_steps).toString()),function(e,t){if(!["bloodmallet.com","127.0.0.1:8000"].includes(window.location.host))return;n&&console.log("provide_meta_data");["trinkets","covenants","conduits","soulbind_nodes","legendaries","soulbinds"].includes(e.data_type)&&(document.getElementById("value_style_switch").hidden=!1);document.getElementById("meta-info").hidden=!1;for(let e in t.simc_settings){let o=document.createTextNode(t.simc_settings[e]),l=document.getElementById("c_"+e);l.innerText="",l.appendChild(o)}let o=document.createElement("a");o.href="https://github.com/simulationcraft/simc/commit/"+t.simc_settings.simc_hash,o.innerText=t.simc_settings.simc_hash.substring(0,7);let l=document.getElementById("c_simc_hash");l.innerText="",l.appendChild(o);for(let e in t.profile.character)try{let o=document.getElementById("c_"+e);o.innerHTML="";let l=void 0;l="soulbind"===e?document.createTextNode(t.profile.character[e].replaceAll(","," ").replaceAll("/"," ")):document.createTextNode(t.profile.character[e].split(" ").map(e=>e[0].toUpperCase()+e.substring(1)).join(" ")),o.appendChild(l)}catch(e){}const a=void 0!==t.profile.character.talents?t.profile.character.talents:"0000000";let i=document.getElementById("c_talents");i.innerHTML="";for(let o=0;o<a.length;o++){const l=a[o];let n=document.createElement("a");n.href="",n.href="https://"+("en"===e.language?"www":e.language)+".wowhead.com/";try{n.href+="spell="+t.talent_data[parseInt(o)+1][parseInt(l)].spell_id}catch(e){continue}n.dataset.whIconSize="medium",i.appendChild(n)}for(let o in t.profile.items){let l=document.createElement("a");l.href="",l.href="https://"+("en"===e.language?"www":e.language)+".wowhead.com/",l.href+="item="+t.profile.items[o].id;let a=[];try{a.push("bonus="+t.profile.items[o].bonus_id.split("/").join(":"))}catch(e){}try{t.profile.items[o].hasOwnProperty("ilevel")&&a.push("ilvl="+t.profile.items[o].ilevel)}catch(e){}a.length>0&&(l.href+="?"+a.join("&")),l.dataset.whIconSize="medium";let n=document.getElementById("c_"+o);n.innerHTML="",n.appendChild(l)}"talents"===e.data_type&&(document.getElementById("talent-warning").hidden=!1,function(e,t){n&&console.log("build_talent_table");document.getElementById("talent-table").hidden=!1;let o=[];for(let e=1;e<8;e++)for(let t=1;t<4;t++)o.push(e.toString()+t.toString());for(let l of o){let o=document.getElementById(l);try{let a=document.createElement("h5"),i=t.talent_data[l.slice(0,1)][l.slice(1,2)];a.innerHTML=N(e,i.name,l,t),o.innerHTML="",o.appendChild(a),o.appendChild(I("Mean",P(l,t))),o.appendChild(I("Min",D(l,t)[1],D(l,t)[0])),o.appendChild(I("Max",B(l,t)[1],B(l,t)[0]));let r=M(l,t),s=r.slice(0,l.slice(0,1)-1)+"0"+r.slice(l.slice(0,1),8),d=t.data[r],c=t.data[s];o.appendChild(I("Max dps",F(c,d),r)),r=M(l,t);let h=F(t.data[t.sorted_data_keys[0]],t.data[r]);o.appendChild(I("Max dps minus global best",h,r))}catch(e){o.innerHTML="-",n&&console.warn(e)}}$(function(){$('[data-toggle="tooltip"]').tooltip()})}(e,t));if("soulbinds"===e.data_type){let o=document.getElementById("post_chart");o.hidden=!1,o.innerHTML="",Object.keys(t.covenant_ids).forEach(l=>{const a=t.covenant_ids[l];let n=document.createElement("h3");n.appendChild(document.createTextNode(H(l,t,e))),o.appendChild(n);let i=0;const r=x(e,_(e,t),t);for(const l of r)if(t.covenant_mapping[l].indexOf(a)>-1){i+=1;let a=document.createElement("h4");a.appendChild(document.createTextNode(i+". "+H(l,t,e))),a.classList+="ml-3",a.id=l,o.appendChild(a);let n=document.createElement("p");n.classList+="ml-5";let r=[];for(const o of w(e,l,t))if(t.data.hasOwnProperty(o)){let l=document.createElement("a");l.href="https://"+("en"===e.language?"www":e.language)+".wowhead.com/",t.hasOwnProperty("spell_ids")&&t.spell_ids.hasOwnProperty(o)&&(l.href+="spell="+t.spell_ids[o]+"/"+L(o)),l.appendChild(document.createTextNode(H(o,t,e))),r.push(l)}for(let e=0;e<r.length;e++)0!==e&&n.appendChild(document.createTextNode(", ")),n.appendChild(r[e]);o.appendChild(n)}})}if("trinkets"===e.data_type){let e=document.getElementById("filter-itemlevels-options");e.innerHTML="";let o=document.getElementById("chart");for(let l of t.simulated_steps){let t="step_"+l,a=document.createElement("div");a.className+=" form-check";let n=document.createElement("input");n.className+=" form-check-input",n.className+=" filter-itemlevels",n.type="checkbox",n.id=t,n.value=l,void 0===o.dataset.filterItemlevels?n.checked=!0:n.checked=-1===o.dataset.filterItemlevels.split(";").indexOf(l.toString()),a.appendChild(n);let i=document.createElement("label");i.className=" form-check-label",i.htmlFor=t,i.appendChild(document.createTextNode(l)),a.appendChild(i),e.appendChild(a),n.addEventListener("change",(e,t)=>{T(e.target.value,e.target.checked),bloodmallet_chart_import()})}let l=document.getElementById("filter-sources-options");l.innerHTML="";let a=Object.values(t.data_sources).filter((e,t,o)=>o.indexOf(e)===t).sort();for(let e of a){let t="step_"+e.replaceAll(" ","_"),a=document.createElement("div");a.className+=" form-check";let n=document.createElement("input");n.className+=" form-check-input",n.className+=" filter-sources",n.type="checkbox",n.id=t,n.value=e,void 0===o.dataset.filterSources?n.checked=!0:n.checked=-1===o.dataset.filterSources.split(";").indexOf(e.toString()),a.appendChild(n);let i=document.createElement("label");i.className=" form-check-label",i.htmlFor=t,i.appendChild(document.createTextNode(e)),a.appendChild(i),l.appendChild(a),n.addEventListener("change",(e,t)=>{O(e.target.value,e.target.checked),bloodmallet_chart_import()})}}try{$WowheadPower.refreshLinks()}catch(e){}}(e,u),"secondary_distributions"===a)return function(e,t,o){n&&console.log("update_secondary_distribution_chart");let l=t.id,a=(e.chart_id,e.fight_style),i=e.wow_class,r=e.wow_spec,s=(e.chart_engine,!1);s=m(e),i=s.simc_settings.class,r=s.simc_settings.spec,a=s.simc_settings.fight_style;let d=E(e),c=!1;if("highcharts"==e.chart_engine)try{c=Highcharts.chart(l,d)}catch(e){return console.log("When trying to create a highcharts chart the following error occured. Did you include the necessary Highcharts scripts?"),void console.log(e)}else if("highcharts_old"==e.chart_engine)try{let e=d;e.chart.renderTo=l,c=new Highcharts.Chart(e)}catch(e){return console.log("When trying to create a highcharts_old chart the following error occured. Did you include the necessary Highcharts scripts?"),void console.log(e)}o=void 0,o=c;let h=void 0;h=Object.keys(s.data)[0];let u=s.data[h][s.sorted_data_keys[h][0]],p=s.data[h][s.sorted_data_keys[h][s.sorted_data_keys[h].length-1]],g=C(100,0,100),f=C(0,0,100),_={name:Intl.NumberFormat().format(u)+" DPS",color:"rgb("+g[0]+","+g[1]+","+g[2]+")",data:[]};for(let t of Object.keys(s.data[h])){let o=s.data[h][t],l=C(o,p,u),a=1,n="#232227",i=5;u===o&&(a=3,i=8,n=e.font_color);let r=void 0;if(t.indexOf("70")>-1)switch(r={enabled:!0,allowOverlap:!0},t.indexOf("70")){case 0:r.format="Crit",r.verticalAlign="top";break;case 3:r.format="Haste";break;case 6:r.format="Mastery",r.verticalAlign="top";break;case 9:r.format="Versatility",r.verticalAlign="top"}const d=s.secondary_sum;let c=parseInt(t.split("_")[0]),m=parseInt(t.split("_")[1]),g=parseInt(t.split("_")[2]),f=parseInt(t.split("_")[3]);_.data.push({x:Math.sqrt(3)/2*(c+1/3*m),y:Math.sqrt(2/3)*m,z:g+.5*c+.5*m,name:t,color:"rgb("+l[0]+","+l[1]+","+l[2]+")",dps:o,dps_max:u,dps_min:p,stat_crit:c*d/100,stat_haste:m*d/100,stat_mastery:g*d/100,stat_vers:f*d/100,stat_sum:d,marker:{radius:i,lineColor:n,lineWidth:a},dataLabels:r})}for(;o.series[0];)o.series[0].remove(!1);o.addSeries(_,!1),o.addSeries({name:Intl.NumberFormat().format(p)+" DPS",color:"rgb("+f[0]+","+f[1]+","+f[2]+")"},!1);let b=s.timestamp,y=b.split("-")[0],v=b.split("-")[1],w=b.split("-")[2].split(" ")[0],x=b.split(" ")[1].split(":")[0],k=b.split(":")[1],A="Last updated ",L=new Date-new Date(Date.UTC(y,v-1,w,x,k)),T=Math.floor(L/24/3600/1e3);T>0&&(A+=`${T}d `);let O=Math.floor(L/3600/1e3)-24*T;A+=`${O}h ago`,o.redraw(),function(e){function t(t){var l=(t=o.pointer.normalize(t)).chartX,a=t.chartY,n=o.options.chart.options3d.alpha,i=o.options.chart.options3d.beta,r=5;function s(e){e=o.pointer.normalize(e),o.update({chart:{options3d:{alpha:n+(e.chartY-a)/r,beta:i+(l-e.chartX)/r}}},void 0,void 0,!1)}o.unbindDragMouse=e.addEvent(document,"mousemove",s),o.unbindDragTouch=e.addEvent(document,"touchmove",s),e.addEvent(document,"mouseup",o.unbindDragMouse),e.addEvent(document,"touchend",o.unbindDragTouch)}e.addEvent(o.container,"mousedown",t),e.addEvent(o.container,"touchstart",t)}(Highcharts)}(e,t,o);a=u.data_type;const p=u;let b,y,v={};b="soulbinds"===a?"nodes"===e.chart_mode?p["sorted_data_keys_"+L(e.covenant).replace("-","_")+"_"+e.conduit_rank].slice(0,i):p.sorted_data_keys[e.conduit_rank].slice(0,i):p.sorted_data_keys.slice(0,i),y=["races","talents"].includes(a)?0:["soulbinds"].includes(a)&&"nodes"===e.chart_mode?p.data.baseline[e.covenant]:["legendaries","soulbind_nodes","soulbinds","covenants","domination_shards"].includes(a)?p.data.baseline:p.data.baseline[p.simulated_steps[p.simulated_steps.length-1]];for(let e of Object.keys(p.data))"{"===e[0]&&"}"===e[e.length-1]&&(v[e]=p.data[e]);n&&(console.log(b),console.log("Baseline dps: "+y),console.log("other baseline dps: "+v));let S=[];if(S="soulbinds"==a&&"soulbinds"===e.chart_mode?void 0:p.simulated_steps,n&&console.log("simulated_steps: "+S),"soulbinds"===a&&"nodes"!==e.chart_mode&&(b=x(e,_(e,p),p)),"trinkets"===a){if(void 0!==e.html_element.dataset.filterItemlevels){const t=e.html_element.dataset.filterItemlevels.split(";");S=S.filter(e=>-1===t.indexOf(e.toString()))}if(b=b.filter(e=>S.some(t=>void 0!==p.data[e][t])),void 0!==e.html_element.dataset.filterActivePassive){const t=e.html_element.dataset.filterActivePassive.split(";");let o=[];t.map(e=>{"active"===e?o.push(!0):"passive"===e&&o.push(!1)}),b=b.filter(e=>-1===o.indexOf(p.data_active[e]))}if(void 0!==e.html_element.dataset.filterSources){const t=e.html_element.dataset.filterSources.split(";");b=b.filter(e=>-1===t.indexOf(p.data_sources[e]))}let t=[];for(let e of b){let o=void 0;for(let t of S)void 0===o&&void 0!==p.data[e][t]&&(o=p.data[e][t]);t.push([e,o])}t.sort((e,t)=>e[1]<=t[1]),b=t.map(e=>e[0])}for(o.setTitle({text:p.title},{text:p.subtitle},!1);o.series[0];)o.series[0].remove(!1);let j=void 0;if(j="talents"===a?b.map(t=>{let o=[];for(let l=0;l<t.length;l++)o.push(A(e,(l+1).toString()+t[l],p));return o.join("")}):b.map(t=>{let o=t.indexOf("} ")>-1?t.slice(t.indexOf("} ")+2,t.length):t;return o=o.indexOf(" +")>-1?o.slice(0,o.indexOf(" +")):o,A(e,o,p)}),n&&console.log(j),"highcharts"==r?o.update({xAxis:{categories:j}},!1):"highcharts_old"==r&&o.xAxis[0].setCategories(j,!1),S){let t={};for(const o in p.data)if(p.data.hasOwnProperty(o)){const l=p.data[o];t[o]={};let n=y;"conduits"===a?n=p.data.baseline[p.covenant_mapping[o]]:"soulbinds"===a&&"nodes"===e.chart_mode&&(n=p.data.baseline[e.covenant]);for(let a=S.length-1;a>=0;a--){const i=S[a];let r=l.hasOwnProperty(e.covenant)?l[e.covenant]:l;Number.isInteger(r)?(t[o][i]=r-n,n=r):r.hasOwnProperty(i)?(t[o][i]=r[i]-n,n=r[i]):t[o][i]=0}}for(const l of S){let n=[];for(let o=0;o<b.length;o++){const a=b[o];n.push(k(e,t[a][l],y))}let i=l;"soulbinds"===a&&"nodes"===e.chart_mode&&(i=d[i]),o.addSeries({data:n,name:i},!1)}}else if(["soulbind_nodes","covenants"].includes(a)){var z=[];for(let t=0;t<b.length;t++){let o=b[t],l=p.data[o]-y;z.push(k(e,l,y))}o.addSeries({data:z,name:"Data",showInLegend:!1},!1)}else if(["legendaries"].includes(a)){let t=[],l="{"+p.profile.character.covenant+"}",a={};for(let e of Object.keys(v))a[e]=[];a[l]=[];for(let o of b){let n=y;if(o.indexOf("} ")>-1){let t=o.slice(0,o.indexOf("} ")+1);n=v[t],a[t].push(k(e,n,y));for(let e of Object.keys(a))e!==t&&a[e].push(0)}else for(let t of Object.keys(a))t!==l?a[t].push(0):a[t].push(k(e,n,n));let i=p.data[o]-n;t.push(k(e,i,n))}o.addSeries({data:t,name:"Legendary effect",showInLegend:!0,color:"#ff7d0a"},!1);let n={night_fae:"Night Fae",necrolord:"Necrolord",venthyr:"Venthyr",kyrian:"Kyrian"};for(let e of Object.keys(a))o.addSeries({data:a[e],name:n[e.slice(1,e.length-1)],showInLegend:!0,color:s[n[e.slice(1,e.length-1)]].color},!1)}else if(["domination_shards"].includes(a)){for(let t of Object.keys(c)){let l=[];for(let o of b){let a=o,n=y;if(o.indexOf(" +")>-1&&(a=o.split(" +")[0],n=p.data[a]),p.shard_type[a]===t){let t=p.data[o]-n;l.push(k(e,t,n))}else l.push(k(e,0,n))}o.addSeries({data:l,name:t+(b[0].indexOf(" +")>-1?" set":""),showInLegend:!0,color:c[t]},!1)}if(b[0].indexOf(" +")>-1){let t=[];for(let o of b){let l=o.split(" +")[0],a=p.data[l]-y;t.push(k(e,a,y))}o.addSeries({data:t,name:"shard",showInLegend:!0,color:"#ff7d0a"},!1)}}else if(["soulbinds"].includes(a)&&"soulbinds"===e.chart_mode){for(const t of Object.keys(s).sort().reverse()){const l=s[t].id;let a=[];for(let t=0;t<b.length;t++){let o=b[t],n=0;p.covenant_mapping[o][0]===l&&(n=f(e,o,p)),a.push(n)}o.addSeries({data:a,name:H(t,p,e),showInLegend:!0,color:s[t].color},!1)}o.yAxis[0].options.title.text=h,o.yAxis[1].options.title.text=h}else{z=[];for(let t=0;t<b.length;t++){let o=b[t],l=p.data[o];"soulbinds"===a&&(l=p.data[o][e.conduit_rank]),z.push(l)}o.addSeries({data:z,name:"DPS",showInLegend:!1},!1)}["trinkets"].indexOf(a)>-1?o.legend.title.attr({text:"Itemlevel"}):"races"===a||"domination_shards"===a?o.legend.title.attr({text:""}):"soulbinds"===a&&"nodes"===e.chart_mode&&o.legend.title.attr({text:"Conduit Rank"}),o.redraw(),"highcharts_old"==r&&o.reflow(),t.style.height=200+30*b.length+"px","highcharts"==r&&o.setSize(t.style.width,t.style.height),"wowdb"==e.tooltip_engine&&setTimeout(function(){!function(e){n&&console.log("readd_wowdb_tooltips");try{CurseTips["wowdb-tooltip"].watchElements(document.getElementById(e).getElementsByTagName("a"))}catch(e){console.log("Setting wowdb (CurseTips) tooltips failed. Error: ",e)}}(t.id)},1)}function f(e,t,o){const l=b(t,o),a=y(e,t,o),n=o.data.baseline[l],i=v(e,t,a,o),r=i.indexOf(Math.max(...i));return n+i[r]}function _(e,t){return t.sorted_data_keys[e.conduit_rank].filter(o=>t.renowns[o][0]<=e.renown)}function b(e,t){return covenant=Object.entries(t.covenant_ids).filter(o=>o[1]===t.covenant_mapping[e][0])[0][0]}function y(e,t,o){return o.paths[t].slice(0,o.paths[t].length).map(l=>l.filter((l,a)=>o.renowns[t][a]<=e.renown))}function v(e,t,o,l){const a=b(t,l),n=l.data.baseline[a];return o.map(t=>{const o=t.map((e,t)=>[e,t]).filter(e=>"Potency Conduit"===e[0]).map(e=>e[1]);return t.map((t,i)=>{let r=0;try{r=l.data[t][a]-n}catch(e){}if("Potency Conduit"===t){let t="sorted_data_keys_"+L(a).replace("-","_")+"_"+e.conduit_rank;r=l.data[l[t].filter(e=>l.conduits.indexOf(e)>-1)[o.indexOf(i)]][a][e.conduit_rank]-n}return r}).reduce((e,t)=>e+t,0)})}function w(e,t,o){const l=y(e,t,o),a=v(e,t,l,o),n=l[a.indexOf(Math.max(...a))],i=n.map((e,t)=>[e,t]).filter(e=>"Potency Conduit"===e[0]).map(e=>e[1]);return n.map((t,l)=>{if("Potency Conduit"===t){const t="sorted_data_keys_"+L(covenant).replace("-","_")+"_"+e.conduit_rank;return o[t].filter(e=>o.conduits.indexOf(e)>-1)[i.indexOf(l)]}return t})}function x(e,t,o){return t.map(t=>[t,f(e,t,o)]).sort((e,t)=>t[1]-e[1]).map(e=>e[0])}function k(e,t,o){return"absolute"===e.value_style?t:"relative"===e.value_style?Math.round(1e4*t/o)/100:void console.error("Unknown value-style",e.value_style)}function C(e,t,o){n&&console.log("create_color");let l=[0,255,255],a=[255,255,0],i=[255,0,0],r=0,s=0;for(let e=0;e<3;e++)r+=Math.abs(i[e]-a[e]),s+=Math.abs(a[e]-l[e]);let d=t+(o-t)*(s/(s+r));if(e>=d){let t=(e-d)/(o-d);return[Math.floor(i[0]*t+a[0]*(1-t)),Math.floor(i[1]*t+a[1]*(1-t)),Math.floor(i[2]*t+a[2]*(1-t))]}{let o=(e-t)/(d-t);return[Math.floor(a[0]*o+l[0]*(1-o)),Math.floor(a[1]*o+l[1]*(1-o)),Math.floor(a[2]*o+l[2]*(1-o))]}}function A(e,t,o){if(n&&(console.log("get_category_name"),console.log(t)),"wowhead"!=e.tooltip_engine&&"wowdb"!=e.tooltip_engine)return H(t,o,e);if(["races"].includes(e.data_type))return H(t,o,e);if(["soulbinds"].includes(e.data_type)&&"soulbinds"===e.chart_mode){let l='<a href="#'+t+'">';return l+=H(t,o,e),l+="</a>"}if("wowhead"==e.tooltip_engine){let l=document.createElement("a");if(l.href="https://"+("en"===e.language?"www":e.language)+".wowhead.com/",o.hasOwnProperty("item_ids")&&o.item_ids.hasOwnProperty(t)){if(l.href+="item="+o.item_ids[t]+"/"+L(t),void 0!==o.simulated_steps){let e=o.simulated_steps[o.simulated_steps.length-1];"string"==typeof e&&e.indexOf("_")>-1&&(e=e.split("_")[1]),l.href+="&ilvl="+e}}else if(o.hasOwnProperty("spell_ids")&&o.spell_ids.hasOwnProperty(t))l.href+="spell="+o.spell_ids[t]+"/"+L(t);else if("talents"===e.data_type){if("0"===t[1])return t[1];l.href+="spell="+o.talent_data[t[0]][t[1]].spell_id}return"talents"===e.data_type?l.appendChild(document.createTextNode(t[1])):l.appendChild(document.createTextNode(H(t,o,e))),l.outerHTML}if("wowdb"==e.tooltip_engine){let l=document.createElement("a");l.href="http://www.wowdb.com/";try{l.href+="items/"+o.item_ids[t]}catch(e){n&&(console.log(e),console.log("We're probably looking at a spell."))}if(l.href.indexOf("items")>-1){let e=o.simulated_steps[o.simulated_steps.length-1];"string"==typeof e&&e.indexOf("_")>-1&&(e=e.split("_")[1]),l.href+="?itemLevel="+e}try{l.href+="spells/"+o.spell_ids[t]}catch(e){n&&(console.log(e),console.log("We're probably looking at an item."))}if("talents"===e.data_type){if("0"===t[1])return t[1];l.href+="spells/"+o.talent_data[t[0]][t[1]].spell_id}l.dataset.tooltipHref=l.href;let a=void 0;return a="talents"===e.data_type?t[1]:H(t,o,e),l.appendChild(document.createTextNode(a)),l.outerHTML}}function L(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function E(i){if(n&&console.log("update_chart_style"),"highcharts"==i.chart_engine||"highcharts_old"==i.chart_engine){if("secondary_distributions"===i.data_type)return{chart:{renderTo:"scatter_plot_chart",type:"scatter3d",backgroundColor:null,animation:!1,height:800,width:800,options3d:{enabled:!0,alpha:10,beta:30,depth:800,fitToPlot:!1}},legend:{enabled:!0,backgroundColor:i.background_color,borderColor:i.font_color,borderWidth:1,align:"right",verticalAlign:"middle",layout:"vertical",itemStyle:{color:i.font_color},itemHoverStyle:{color:i.font_color}},plotOptions:{series:{dataLabels:{allowOverlap:!0,style:{color:i.font_color,fontSize:i.font_size,fontWeight:"400",textOutline:""}},events:{legendItemClick:function(){return!1}}}},series:[],title:{text:"",useHTML:!0,style:{color:i.font_color}},subtitle:{text:"",useHTML:!0,style:{color:i.font_color,fontSize:i.font_size}},tooltip:{headerFormat:"",pointFormatter:function(){return'<table class="">                <thead>                  <tr>                    <th scope="col"></th>                    <th scope="col">Absolute</th>                    <th scope="col">Relative</th>                  </tr>                </thead>                <tbody>                  <tr>                    <th scope="row">DPS</th>                    <td>'+Intl.NumberFormat().format(this.dps)+"</td>                    <td>"+Math.round(this.dps/this.dps_max*1e4)/100+'%</td>                  </tr>                  <tr>                    <th scope="row">Crit</th>                    <td>'+Intl.NumberFormat().format(this.stat_crit)+"</td>                    <td>"+this.name.split("_")[0]+'%</td>                  </tr>                  <tr>                    <th scope="row">Haste</th>                    <td>'+Intl.NumberFormat().format(this.stat_haste)+"</td>                    <td>"+this.name.split("_")[1]+'%</td>                  </tr>                  <tr>                    <th scope="row">Mastery</th>                    <td>'+Intl.NumberFormat().format(this.stat_mastery)+"</td>                    <td>"+this.name.split("_")[2]+'%</td>                  </tr>                  <tr>                    <th scope="row">Versatility</th>                    <td>'+Intl.NumberFormat().format(this.stat_vers)+"</td>                    <td>"+this.name.split("_")[3]+"%</td>                  </tr>                </tbody>              </table>"},useHTML:!0,borderColor:i.background_color},xAxis:{min:0,max:80,tickInterval:20,startOnTick:!0,endOnTick:!0,title:"",labels:{enabled:!1},gridLineWidth:1,gridLineColor:i.axis_color},yAxis:{min:-10,max:70,tickInterval:20,startOnTick:!0,endOnTick:!0,title:"",labels:{enabled:!1},gridLineWidth:1,gridLineColor:i.axis_color},zAxis:{min:10,max:90,tickInterval:20,startOnTick:!0,endOnTick:!0,title:"",labels:{enabled:!1},reversed:!0,gridLineWidth:1,gridLineColor:i.axis_color}};let n=i.background_color,r=i.axis_color,s=i.font_color,d="https://bloodmallet.com/";void 0!==i.chart_id?d+="chart/"+i.chart_id:void 0!==i.wow_class&&void 0!==i.wow_spec&&(d+="#"+i.wow_class+"_"+i.wow_spec);let c={chart:{type:"bar",backgroundColor:t,style:{fontFamily:'-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"'}},colors:e,credits:{href:d,text:"bloodmallet",style:{fontSize:a}},legend:{align:"right",backgroundColor:t,borderColor:l,borderWidth:1,floating:!1,itemMarginBottom:3,itemMarginTop:0,layout:"vertical",reversed:!0,shadow:!1,verticalAlign:"middle",x:0,y:0,itemStyle:{color:o},itemHoverStyle:{color:o},title:{text:" ",style:{color:o}},symbolRadius:0},plotOptions:{series:{stacking:"normal",borderColor:t,events:{legendItemClick:function(){return!1}},style:{textOutline:!1,fontSize:a},point:{events:{click:function(e){var t=this.series.yAxis;t.removePlotLine("helperLine"),t.addPlotLine({value:this.stackY,color:i.font_color,width:2,id:"helperLine",zIndex:5,label:{text:this.series.name+" "+this.category,style:{color:i.font_color,fontSize:a},align:"left",verticalAlign:"bottom",rotation:0,y:-5}})}}}}},series:[],title:{text:"Loading data...",useHTML:!0,style:{color:o,fontSize:a}},subtitle:{text:'...from <a href="https://bloodmallet.com">bloodmallet</a>',useHTML:!0,style:{color:o,fontSize:a}},tooltip:{headerFormat:"<b>{point.x}</b>",shared:!0,backgroundColor:t,borderColor:l,style:{color:o,fontSize:a},useHTML:!0},xAxis:{categories:[],labels:{useHTML:!0,style:{color:o,fontSize:a}},gridLineWidth:0,gridLineColor:l,lineColor:l,tickColor:l},yAxis:[{labels:{style:{color:l}},min:0,stackLabels:{enabled:!0,formatter:function(){return Intl.NumberFormat().format(this.total)},style:{color:o,textOutline:!1,fontSize:a,fontWeight:"normal"}},title:{text:"absolute"===i.value_style?h:u,style:{color:l}},gridLineWidth:1,gridLineColor:l},{linkedTo:0,opposite:!0,labels:{style:{color:l}},min:0,stackLabels:{enabled:!0,formatter:function(){return Intl.NumberFormat().format(this.total)},style:{color:o,textOutline:!1,fontSize:a,fontWeight:"normal"}},title:{text:"absolute"===i.value_style?h:u,style:{color:l}},gridLineWidth:1,gridLineColor:l}]};return c.chart.backgroundColor=n,c.legend.backgroundColor=n,c.legend.borderColor=r,c.legend.itemStyle.color=s,c.legend.itemHoverStyle.color=s,c.title.style.color=s,c.subtitle.style.color=s,c.tooltip.formatter=function(){let e=document.createElement("div");e.style.margin="-4px -7px -7px -7px",e.style.padding="3px 3px 6px 3px",e.style.backgroundColor="transparent"!==n?n:t,"highcharts_old"===i.chart_engine&&(e.style.margin="-7px");let o=document.createElement("div");e.appendChild(o),o.style.marginLeft="9px",o.style.marginRight="9px",o.style.marginBottom="6px",o.style.fontWeight="700",o.innerHTML=this.x;let l=0;for(var a=this.points.length-1;a>=0;a--)if(l+=this.points[a].y,0!==this.points[a].y){let t=document.createElement("div");e.appendChild(t);let o=document.createElement("span");t.appendChild(o),o.style.marginLeft="9px",o.style.borderLeft="9px solid "+this.points[a].series.color,o.style.paddingLeft="4px",Number.isInteger(this.points[a].series.name)&&o.appendChild(document.createTextNode(this.points[a].series.name+":")),t.appendChild(document.createTextNode("  "+Intl.NumberFormat().format(l)+("relative"!==i.value_style||"soulbinds"===i.data_type&&"soulbinds"===i.chart_mode?"":"%")))}return e.outerHTML},c.tooltip.backgroundColor="transparent"!==n?n:t,c.tooltip.borderColor=r,c.tooltip.style.color=s,c.xAxis.labels.style.color=s,c.xAxis.gridLineColor=r,c.xAxis.lineColor=r,c.xAxis.tickColor=r,c.yAxis[0].labels.style.color=r,c.yAxis[0].stackLabels.style.color=s,c.yAxis[0].gridLineColor=r,c.yAxis[0].lineColor=r,c.yAxis[0].tickColor=r,c.yAxis[0].title.style.color=r,c.yAxis[1].labels.style.color=r,c.yAxis[1].stackLabels.style.color=s,c.yAxis[1].gridLineColor=r,c.yAxis[1].lineColor=r,c.yAxis[1].tickColor=r,c.yAxis[1].title.style.color=r,c.credits.style.color=s,c}}function T(e,t){let o=document.getElementById("chart"),l=o.dataset.filterItemlevels;t?o.dataset.filterItemlevels=l.split(";").filter(t=>t!==e).join(";"):void 0===l||0===l.length?o.dataset.filterItemlevels=e:o.dataset.filterItemlevels=l+";"+e}function O(e,t){let o=document.getElementById("chart"),l=o.dataset.filterSources;t?o.dataset.filterSources=l.split(";").filter(t=>t!==e).join(";"):void 0===l||0===l.length?o.dataset.filterSources=e:o.dataset.filterSources=l+";"+e}function I(e,t,o){let l=document.createElement("div");l.innerHTML=e+": ";let a=document.createElement("span");if(a.innerHTML=t+"%",a.classList+=S(t>=0?t:3-t),void 0!==o){a.title="Talent combination: "+o,a.setAttribute("data-toggle","tooltip"),a.setAttribute("data-placement","bottom");let e=document.createElement("span");e.classList+="priest-color",e.innerHTML=" (?)",a.appendChild(e)}return l.appendChild(a),l}function S(e){return n&&console.log("get_value_color"),e<5?"mage-color":e>10&&e<=12?"druid-color":e>12?"death_knight-color":"monk-color"}function M(e,t){for(let o of t.sorted_data_keys)if(o[e.slice(0,1)-1]===e.slice(1,2))return o;return!1}function N(e,t,o,l){let a='<a href="https://';return"en"===e.language||"EN"===e.language?a+="www":a+=e.language.toLowerCase(),a+=".wowhead.com/spell=",a+=l.talent_data[o.slice(0,1)][o.slice(1,2)].spell_id,a+='"',a+=">",a+=H(t,l,e),a+="</a>"}function H(e,t,o){n&&console.log("get_translated_name "+e);let l="";try{l=t.translations[e][r[o.language]]}catch(t){n&&(console.log(`No translation for ${e} found.`),console.log(t)),l=e}return n&&console.log("Translated name: "+l),void 0===l&&(l=e),l}function D(e,t){let o=e.slice(0,1),l=e.slice(1,2),a=100,n="";for(let e of t.sorted_data_keys)if(e[o-1]===l){let l=t.data[e],i=t.data[e.slice(0,o-1)+"0"+e.slice(o,8)];a>F(i,l)&&(a=F(i,l),n=e)}return[n,a]}function B(e,t){let o=e.slice(0,1),l=e.slice(1,2),a=-100,n="";for(let e of t.sorted_data_keys)if(e[o-1]===l){let l=t.data[e],i=t.data[e.slice(0,o-1)+"0"+e.slice(o,8)];a<F(i,l)&&(a=F(i,l),n=e)}return[n,a]}function P(e,t){n&&console.log("get_average_gain");let o=[];for(let l of t.sorted_data_keys)l[e.slice(0,1)-1]===e.slice(1,2)&&o.push(l);let l=0;for(let a of o){let o=t.data[a];l+=F(t.data[a.slice(0,e.slice(0,1)-1)+"0"+a.slice(e.slice(0,1),8)],o)}return Math.round(l/o.length*100)/100}function F(e,t){return n&&console.log("get_percentage_gain"),Math.round(100*(100*t/e-100))/100}this.init_charts=new function(){n&&console.log("init_charts");let e=document.querySelectorAll("div.bloodmallet_chart"),a=[];for(let t=0;t<e.length;t++){const o=e[t];if(a.indexOf(o.id)>-1)return void console.error("Multiple Elements use the same ID ('"+o.id+"'). Aborting bloodmallet_chart_import.js.");a.push(o.id)}for(let a=0;a<e.length;a++){let i=void 0;try{i=e[a].id}catch(e){return void console.error("Each .bloodmallet_chart needs an ID. Aborting bloodmallet_chart_import.js.")}const r=document.getElementById(e[a].id);if(r){let e={chart_id:void 0,wow_class:void 0,wow_spec:void 0,data_type:"trinkets",conduit_rank:"7",fight_style:"castingpatchwerk",chart_mode:"soulbinds",covenant:"Kyrian",renown:"35",axis_color:l,background_color:t,font_color:o,limit:7,chart_engine:"highcharts",tooltip_engine:"wowhead",language:"en",value_style:"absolute",html_element:r};try{void 0!==bloodmallet.style.axis_color&&(e.axis_color=bloodmallet.style.axis_color),void 0!==bloodmallet.style.background_color&&(e.background_color=bloodmallet.style.background_color),void 0!==bloodmallet.style.font_color&&(e.font_color=bloodmallet.style.font_color),void 0!==bloodmallet.settings.entries&&(e.limit=bloodmallet.settings.entries),void 0!==bloodmallet.settings.chart_engine&&(e.chart_engine=bloodmallet.settings.chart_engine),void 0!==bloodmallet.settings.tooltip_engine&&(e.tooltip_engine=bloodmallet.settings.tooltip_engine),void 0!==bloodmallet.settings.language&&(e.language=bloodmallet.settings.language),void 0!==bloodmallet.settings.value_style&&(e.value_style=bloodmallet.settings.value_style)}catch(e){n&&console.log("Applying page wide settings failed or no page wide settings were found.")}r.getAttribute("data-entries")&&(e.limit=r.getAttribute("data-entries")),r.getAttribute("data-fight-style")&&(e.fight_style=r.getAttribute("data-fight-style")),r.getAttribute("data-type")&&(e.data_type=r.getAttribute("data-type")),r.getAttribute("data-chart-mode")&&(e.chart_mode=r.getAttribute("data-chart-mode")),r.getAttribute("data-covenant")&&(e.covenant=r.getAttribute("data-covenant")),r.getAttribute("data-renown")&&(e.renown=r.getAttribute("data-renown")),r.getAttribute("data-conduit-rank")&&(e.conduit_rank=r.getAttribute("data-conduit-rank")),r.getAttribute("data-background-color")&&(e.background_color=r.getAttribute("data-background-color")),r.getAttribute("data-font-color")&&(e.font_color=r.getAttribute("data-font-color")),r.getAttribute("data-axis-color")&&(e.axis_color=r.getAttribute("data-axis-color")),r.getAttribute("data-tooltip-engine")&&(e.tooltip_engine=r.getAttribute("data-tooltip-engine")),r.getAttribute("data-chart-engine")&&(e.chart_engine=r.getAttribute("data-chart-engine")),r.getAttribute("data-language")&&(e.language=r.getAttribute("data-language")),r.getAttribute("data-value-style")&&(e.value_style=r.getAttribute("data-value-style"));let a=!0;r.getAttribute("data-chart-id")?e.chart_id=r.getAttribute("data-chart-id"):(r.getAttribute("data-wow-class")||(console.error("Required 'data-chart-id' or 'data-wow-class' attribute wasn't found in "+i+"."),a=!1),e.wow_class=r.getAttribute("data-wow-class"),r.getAttribute("data-wow-spec")||(console.error("Required 'data-chart-id' or 'data-wow-spec' attribute wasn't found in "+i+"."),a=!1),e.wow_spec=r.getAttribute("data-wow-spec"));let s=E(e),d=!1;if("highcharts"==e.chart_engine)try{d=Highcharts.chart(i,s)}catch(e){return console.log("When trying to create a highcharts chart the following error occured. Did you include the necessary Highcharts scripts?"),void console.log(e)}else if("highcharts_old"==e.chart_engine)try{let e=s;e.chart.renderTo=i,d=new Highcharts.Chart(e)}catch(e){return console.log("When trying to create a highcharts_old chart the following error occured. Did you include the necessary Highcharts scripts?"),void console.log(e)}a?p(e):d.setTitle({text:"Wrong chart setup"},{text:"Missing 'data-chart-id', 'data-wow-class' or 'data-wow-spec'. See <a href=\"https://github.com/Bloodmallet/bloodmallet_web_frontend/wiki/How-to-import-charts\">wiki</a>"}),setTimeout(g,1,e,r,d,0)}}}}document.addEventListener("DOMContentLoaded",function(){bloodmallet_chart_import()});