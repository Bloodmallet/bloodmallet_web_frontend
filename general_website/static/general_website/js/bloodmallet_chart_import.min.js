function bloodmallet_chart_import(){const e=["#7cb5ec","#d9d9df","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"],t="#343a40",o="#f8f9fa",a="#828282",l="1.1rem",n=!1,r="https://bloodmallet.com/chart/get/",i={cn:"cn_CN",en:"en_US",de:"de_DE",es:"es_ES",fr:"fr_FR",it:"it_IT",ko:"ko_KR",pt:"pt_BR",ru:"ru_RU","zh-hans":"cn_CN"},s={Kyrian:{id:1,color:"#69ccf0"},Venthyr:{id:2,color:"#c41f3b"},"Night Fae":{id:3,color:"#a330c9"},Necrolord:{id:4,color:"#abd473"}},d={unholy:"#abd473",frost:"#69ccf0",blood:"#c41f3b"},c="Δ Damage per second",h="% Damage per second";function u(e){n&&console.log("load_data");let t=e.chart_id,o=e.data_type,a=e.fight_style,l=e.wow_class,i=e.wow_spec;try{if(m(e))return}catch(e){n&&(console.log("Data needs to be loaded."),console.log(e))}let s=a;s+="/"+l,s+="/"+i;let d="";d=t?r+t:r+o+"/"+s;let c=new XMLHttpRequest;n&&console.log("Fetching data from: "+d),c.open("GET",d,!0),c.onload=function(t){if(4===c.readyState)if(200===c.status){let t=JSON.parse(c.responseText);e.html_element.dataset.loadedData=c.responseText,n&&(console.log(t),console.log("Load and save finished."))}else console.error(c.statusText)},c.onerror=function(e){console.error("Fetching data from bloodmallet.com encountered an error, ",e)},c.send(null)}function m(e){return JSON.parse(e.html_element.dataset.loadedData)}function p(e,t,o,a){n&&console.log("update_chart");let l=e.data_type,r=e.limit,i=e.chart_engine,h=!1;try{h=m(e)}catch(l){return void(a<30&&setTimeout(p,200,e,t,o,a+1))}if(e.data=h,"highcharts_old"!=i&&o.update({accessibility:{enable:!1}},!1),!0===h.error||"error"===h.status)return function(e,t){let o=e;if(o.innerHTML="","error"===t.status){let e=document.createElement("p");e.innerText=t.message,o.appendChild(e)}else{let e=document.createElement("p");e.innerText="An error occured during simulation.",o.appendChild(e);let a=document.createElement("ul"),l=document.createElement("li");l.textContent="Title: "+(t.title?t.title:"~"),a.appendChild(l);let n=document.createElement("li");n.textContent="Spec: "+t.wow_spec+" "+t.wow_class,a.appendChild(n);let r=document.createElement("li");r.textContent="Type: "+t.simulation_type,a.appendChild(r);let i=document.createElement("li");i.textContent="Fight style: "+t.fight_style,a.appendChild(i);let s=document.createElement("li");s.textContent="ID: "+t.id,a.appendChild(s);let d=document.createElement("li");d.textContent="Custom profile:",a.appendChild(d),d.appendChild(document.createElement("br"));let c=document.createElement("textarea");c.value=t.custom_profile,c.placeholder="No custom profile",c.style.width="100%",c.classList.add("form-control"),d.appendChild(c);let h=document.createElement("li");h.textContent="Log:",a.appendChild(h),h.appendChild(document.createElement("br"));let u=document.createElement("textarea");u.value=t.log,u.placeholder="No log available",u.style.width="100%",u.classList.add("form-control"),h.appendChild(u),o.appendChild(a)}}(t,h);if(wow_class=h.simc_settings.class,wow_spec=h.simc_settings.spec,fight_style=h.simc_settings.fight_style,e.data_type=l=h.data_type,("legendaries"===e.data_type||"tier_set"===e.data_type)&&(e.value_style="absolute"),v(e,h),"secondary_distributions"===l)return function(e,t,o){n&&console.log("update_secondary_distribution_chart");let a=t.id,l=(e.chart_id,e.fight_style),r=e.wow_class,i=e.wow_spec,s=(e.chart_engine,!1);s=m(e),r=s.simc_settings.class,i=s.simc_settings.spec,l=s.simc_settings.fight_style;let d=x(e),c=!1;if("highcharts"==e.chart_engine)try{c=Highcharts.chart(a,d)}catch(e){return console.log("When trying to create a highcharts chart the following error occurred. Did you include the necessary Highcharts scripts?"),void console.log(e)}else if("highcharts_old"==e.chart_engine)try{let e=d;e.chart.renderTo=a,c=new Highcharts.Chart(e)}catch(e){return console.log("When trying to create a highcharts_old chart the following error occurred. Did you include the necessary Highcharts scripts?"),void console.log(e)}if(o=void 0,o=c,w()&&0===document.getElementById(s.data_type+"-selector-area").children.length){let e=document.getElementById(s.data_type+"-selector-area"),t=document.createElement("select");t.id=s.data_type+"-selector",t.classList.add("custom-select");for(const e of Object.keys(s.sorted_data_keys)){let o=document.createElement("option");o.value=e,o.text="Build: "+e,"baseline"===e&&(o.selected=!0),t.appendChild(o)}e.appendChild(t),e.addEventListener("change",(()=>{bloodmallet_chart_import()})),Object.keys(s.sorted_data_keys).length>1&&(e.hidden=!1)}let h="baseline";w()&&void 0!==document.getElementById(s.data_type+"-selector")&&(h=document.getElementById(s.data_type+"-selector").value);let u=s.data[h][s.sorted_data_keys[h][0]],p=s.data[h][s.sorted_data_keys[h][s.sorted_data_keys[h].length-1]],g=f(100,0,100),_=f(0,0,100),y={name:Intl.NumberFormat().format(u)+" DPS",color:"rgb("+g[0]+","+g[1]+","+g[2]+")",data:[]};for(let t of Object.keys(s.data[h])){let o,a=s.data[h][t],l=f(a,p,u),n=1,r="#232227",i=5;if(u===a&&(n=3,i=8,r=e.font_color),t.indexOf("70")>-1)switch(o={enabled:!0,allowOverlap:!0},t.indexOf("70")){case 0:o.format="Crit",o.verticalAlign="top";break;case 3:o.format="Haste";break;case 6:o.format="Mastery",o.verticalAlign="top";break;case 9:o.format="Versatility",o.verticalAlign="top"}const d=s.secondary_sum;let c=parseInt(t.split("_")[0]),m=parseInt(t.split("_")[1]),g=parseInt(t.split("_")[2]),_=parseInt(t.split("_")[3]);y.data.push({x:Math.sqrt(3)/2*(c+1/3*m),y:Math.sqrt(2/3)*m,z:g+.5*c+.5*m,name:t,color:"rgb("+l[0]+","+l[1]+","+l[2]+")",dps:a,dps_max:u,dps_min:p,stat_crit:c*d/100,stat_haste:m*d/100,stat_mastery:g*d/100,stat_vers:_*d/100,stat_sum:d,marker:{radius:i,lineColor:r,lineWidth:n},dataLabels:o})}for(;o.series[0];)o.series[0].remove(!1);o.addSeries(y,!1),o.addSeries({name:Intl.NumberFormat().format(p)+" DPS",color:"rgb("+_[0]+","+_[1]+","+_[2]+")"},!1);try{o.setTitle({text:s.title},{text:s.subtitle},!1)}catch(e){console.log(e)}o.redraw(),function(e){function t(t){var a=(t=o.pointer.normalize(t)).chartX,l=t.chartY,n=o.options.chart.options3d.alpha,r=o.options.chart.options3d.beta,i=5;function s(e){e=o.pointer.normalize(e),o.update({chart:{options3d:{alpha:n+(e.chartY-l)/i,beta:r+(a-e.chartX)/i}}},void 0,void 0,!1)}o.unbindDragMouse=e.addEvent(document,"mousemove",s),o.unbindDragTouch=e.addEvent(document,"touchmove",s),e.addEvent(document,"mouseup",o.unbindDragMouse),e.addEvent(document,"touchend",o.unbindDragTouch)}e.addEvent(o.container,"mousedown",t),e.addEvent(o.container,"touchstart",t)}(Highcharts)}(e,t,o);if("talent_target_scaling"===l)return function(e,t,o){n&&console.log("update_talent_target_scaling_chart");let a=t.id,l=(e.chart_id,e.fight_style),r=e.wow_class,i=e.wow_spec,s=(e.chart_engine,m(e));document.getElementById("post_chart").hidden=!1,r=s.profile.character.class,i=s.profile.character.spec,l=s.simc_settings.fight_style;let d=x(e),c=!1;if("highcharts"==e.chart_engine)try{c=Highcharts.chart(a,d)}catch(e){return console.log("When trying to create a highcharts chart the following error occurred. Did you include the necessary Highcharts scripts?"),void console.log(e)}else if("highcharts_old"==e.chart_engine)try{let e=d;e.chart.renderTo=a,c=new Highcharts.Chart(e)}catch(e){return console.log("When trying to create a highcharts_old chart the following error occurred. Did you include the necessary Highcharts scripts?"),void console.log(e)}o=void 0,o=c;for(;o.series[0];)o.series[0].remove(!1);for(const t of s.sorted_data_keys){const a=s.data[t],l=Object.keys(a);let n=-1;n=e.talent_target_scaling_min_target_count>-1?e.talent_target_scaling_min_target_count:Math.min(...l.map((e=>parseInt(e))));let r=-1;r=e.talent_target_scaling_max_target_count>-1?e.talent_target_scaling_max_target_count:Math.max(...l.map((e=>parseInt(e))));let i=[];for(let e=n;e<=r;e++)l.indexOf(e.toString())>=-1?i.push([e,a[e]]):i.push([e,null]);let d={name:t,data:i};o.addSeries(d,!1),o.update({xAxis:{min:n-.5,max:r+.5}})}try{o.setTitle({text:s.title},{text:s.subtitle},!1)}catch(e){console.log(e)}o.redraw()}(e,t,o);l=h.data_type;const u=h;let y,b,k={};y=Object.keys(u).indexOf("sorted_data_keys")>-1&&["windfury_totem","power_infusion"].indexOf(l)>-1&&"absolute"===e.value_style?u.sorted_data_keys_2.slice(0,r):Object.keys(u).indexOf("sorted_data_keys")>-1?u.sorted_data_keys.slice(0,r):Object.keys(u.data),["races","talents","soulbinds","tier_set","windfury_totem","power_infusion"].includes(l)?b=0:["legendaries","soulbind_nodes","covenants","domination_shards"].includes(l)?b=u.data.baseline:(b=u.data.baseline[u.simulated_steps[u.simulated_steps.length-1]],n&&(console.log("minimal itemlevel",u.simulated_steps[u.simulated_steps.length-1]),console.log("baseline dps dict",u.data.baseline),console.log("Baseline dps: "+b)));for(let e of Object.keys(u.data))"{"===e[0]&&"}"===e[e.length-1]&&(k[e]=u.data[e]);n&&(console.log("dps_ordered_keys",y),console.log("Baseline dps: "+b),console.log("other baseline dps:",k));let C=[];if(C="soulbinds"===l?void 0:"tier_set"===l?["4p","2p","no tier"]:u.simulated_steps,n&&console.log("simulated_steps: "+C),"trinkets"===l){if(void 0!==e.html_element.dataset.filterItemlevels){const t=e.html_element.dataset.filterItemlevels.split(";");C=C.filter((e=>-1===t.indexOf(e.toString())))}if(y=y.filter((e=>C.some((t=>void 0!==u.data[e][t])))),void 0!==e.html_element.dataset.filterActivePassive){const t=e.html_element.dataset.filterActivePassive.split(";");let o=[];t.map((e=>{"active"===e?o.push(!0):"passive"===e&&o.push(!1)})),y=y.filter((e=>-1===o.indexOf(u.data_active[e])))}if(void 0!==e.html_element.dataset.filterSources){const t=e.html_element.dataset.filterSources.split(";");y=y.filter((e=>-1===t.indexOf(u.data_sources[e])))}let t=[];for(let e of y){let o;for(let t of C)(void 0===o&&void 0!==u.data[e][t]||void 0!==u.data[e][t]&&u.data[e][t]>o)&&(o=u.data[e][t]);t.push([e,o])}t.sort(((e,t)=>t[1]-e[1])),y=t.map((e=>e[0]))}let O,A=u.subtitle;for("power_infusion"===l&&(A+="<br/>* Spec APL doesn't support external PI. Fallback for set PI timings was used to generate data."),o.setTitle({text:u.title},{text:A},!1);o.series[0];)o.series[0].remove(!1);if(O=["talents"].indexOf(l)>-1?y.map((t=>{let o=[];for(let a=0;a<t.length;a++)o.push(_(e,(a+1).toString()+t[a],u));return o.join("")})):["tier_set","talent_target-scaling"].indexOf(l)>-1?y.map((t=>_(e,t,u))):y.map((t=>{let o=t.indexOf("} ")>-1?t.slice(t.indexOf("} ")+2,t.length):t;return o=o.indexOf(" +")>-1?o.slice(0,o.indexOf(" +")):o,_(e,o,u)})),"power_infusion"===l&&(O=O.map((e=>Object.keys(h).indexOf("profile_without_pi_support")>-1&&h.profile_without_pi_support.indexOf(e)>-1?e+"*":e))),n&&console.log(O),"highcharts"==i?o.update({xAxis:{categories:O}},!1):"highcharts_old"==i&&o.xAxis[0].setCategories(O,!1),C){let t={};for(const o in u.data)if(u.data.hasOwnProperty(o)){const a=u.data[o];t[o]={};let n=b;"conduits"===l&&(n=u.data.baseline[u.covenant_mapping[o]]);for(let l=C.length-1;l>=0;l--){const r=C[l];let i=a.hasOwnProperty(e.covenant)?a[e.covenant]:a;Number.isInteger(i)?(t[o][r]=Math.max(i-n,0),n=0===t[o][r]?n:i):i.hasOwnProperty(r)?(t[o][r]=Math.max(i[r]-n,0),n=0===t[o][r]?n:i[r]):t[o][r]=0}}n&&(console.log("simulated_steps",C),console.log(t));for(const a of C){let l=[];for(let o=0;o<y.length;o++){const n=y[o];let r=g(e,t[n][a],b);l.push(r)}let n=a;o.addSeries({data:l,name:n},!1)}}else if(["soulbind_nodes","covenants"].includes(l)){var L=[];for(let t=0;t<y.length;t++){let o=y[t],a=u.data[o]-b;L.push(g(e,a,b))}o.addSeries({data:L,name:"Data",showInLegend:!1},!1)}else if(["legendaries"].includes(l)){let t=[],a="{"+u.profile.character.covenant+"}",l={};for(let e of Object.keys(k))l[e]=[];l[a]=[];for(let o of y){let n=b;if(o.indexOf("} ")>-1){let t=o.slice(0,o.indexOf("} ")+1);n=k[t],l[t].push(g(e,n,b));for(let e of Object.keys(l))e!==t&&l[e].push(0)}else for(let t of Object.keys(l))t!==a?l[t].push(0):l[t].push(g(e,n,n));let r=u.data[o]-n;t.push(g(e,r,n))}o.addSeries({data:t,name:"Legendary effect",showInLegend:!0,color:"#ff7d0a"},!1);let n={night_fae:"Night Fae",necrolord:"Necrolord",venthyr:"Venthyr",kyrian:"Kyrian"};for(let e of Object.keys(l))o.addSeries({data:l[e],name:n[e.slice(1,e.length-1)],showInLegend:!0,color:s[n[e.slice(1,e.length-1)]].color},!1)}else if(["windfury_totem","power_infusion"].includes(l)){let t=[],a={"Blood Death Knight":"#c41f3b","Frost Death Knight":"#c41f3b","Unholy Death Knight":"#c41f3b","Havoc Demon Hunter":"#a330c9","Vengeance Demon Hunter":"#a330c9","Balance Druid":"#ff7d0a","Feral Druid":"#ff7d0a","Guardian Druid":"#ff7d0a","Devastation Evoker":"#33937F","Beast_Mastery Hunter":"#abd473","Marksmanship Hunter":"#abd473","Survival Hunter":"#abd473","Arcane Mage":"#69ccf0","Fire Mage":"#69ccf0","Frost Mage":"#69ccf0","Brewmaster Monk":"#00ff96","Windwalker Monk":"#00ff96","Protection Paladin":"#f58cba","Retribution Paladin":"#f58cba","Shadow Priest":"#ffffff","Assassination Rogue":"#fff569","Outlaw Rogue":"#fff569","Subtlety Rogue":"#fff569","Elemental Shaman":"#0070de","Enhancement Shaman":"#0070de","Affliction Warlock":"#9482c9","Demonology Warlock":"#9482c9","Destruction Warlock":"#9482c9","Arms Warrior":"#c79c6e","Fury Warrior":"#c79c6e","Protection Warrior":"#c79c6e"};for(let o of y){let l=u.data["{"+o+"}"],n=u.data[o]-l;t.push({y:g(e,n,l),color:a[o]})}o.addSeries({data:t,name:(T=l,T.split("_").map((e=>e[0].toUpperCase()+e.substring(1))).join(" ")),showInLegend:!1},!1)}else if(["domination_shards"].includes(l)){for(let t of Object.keys(d)){let a=[];for(let o of y){let l=o,n=b;if(o.indexOf(" +")>-1&&(l=o.split(" +")[0],n=u.data[l]),u.shard_type[l]===t){let t=u.data[o]-n;a.push(g(e,t,n))}else a.push(g(e,0,n))}o.addSeries({data:a,name:t+(y[0].indexOf(" +")>-1?" set":""),showInLegend:!0,color:d[t]},!1)}if(y[0].indexOf(" +")>-1){let t=[];for(let o of y){let a=o.split(" +")[0],l=u.data[a]-b;t.push(g(e,l,b))}o.addSeries({data:t,name:"shard",showInLegend:!0,color:"#ff7d0a"},!1)}}else if(["soulbinds"].includes(l)){for(const t of Object.keys(s).sort().reverse()){const a=s[t].id;let l=[];for(const e of y){let t=0;u.covenant_mapping[e][0]===a&&(t=Math.max(...Object.values(u.data[e]))),l.push(t)}o.addSeries({data:l,name:E(t,u,e),showInLegend:!0,color:s[t].color},!1)}o.yAxis[0].options.title.text=c,o.yAxis[1].options.title.text=c}else{L=[];for(let e=0;e<y.length;e++){let t=y[e],o=u.data[t];L.push(o)}o.addSeries({data:L,name:"DPS",showInLegend:!1},!1)}var T;["trinkets"].indexOf(l)>-1?o.legend.title.attr({text:"Itemlevel"}):"races"!==l&&"domination_shards"!==l||o.legend.title.attr({text:""}),"highcharts_old"==i&&o.reflow(),t.style.height=200+30*y.length+"px","highcharts"==i&&o.setSize(void 0,t.style.height),"wowdb"==e.tooltip_engine?setTimeout((()=>{!function(e){n&&console.log("readd_wowdb_tooltips");try{CurseTips["wowdb-tooltip"].watchElements(document.getElementById(e).getElementsByTagName("a"))}catch(e){console.log("Setting wowdb (CurseTips) tooltips failed. Error: ",e)}}(t.id),o.redraw()}),1):"wowhead"==e.tooltip_engine?setTimeout((()=>{window.$WowheadPower.refreshLinks(),setTimeout((()=>{o.redraw()}),300)}),1):setTimeout((()=>{o.redraw()}),1)}function g(e,t,o){return"absolute"===e.value_style?t:"relative"===e.value_style?Math.round(1e4*t/o)/100:void console.error("Unknown value-style",e.value_style)}function f(e,t,o){n&&console.log("create_color");let a=[0,255,255],l=[255,255,0],r=[255,0,0],i=0,s=0;for(let e=0;e<3;e++)i+=Math.abs(r[e]-l[e]),s+=Math.abs(l[e]-a[e]);let d=t+(o-t)*(s/(s+i));if(e>=d){let t=(e-d)/(o-d);return[Math.floor(r[0]*t+l[0]*(1-t)),Math.floor(r[1]*t+l[1]*(1-t)),Math.floor(r[2]*t+l[2]*(1-t))]}{let o=(e-t)/(d-t);return[Math.floor(l[0]*o+a[0]*(1-o)),Math.floor(l[1]*o+a[1]*(1-o)),Math.floor(l[2]*o+a[2]*(1-o))]}}function _(e,t,o){if(n&&(console.log("get_category_name"),console.log(t)),"wowhead"!=e.tooltip_engine&&"wowdb"!=e.tooltip_engine)return E(t,o,e);if(["races","windfury_totem","power_infusion"].includes(e.data_type))return E(t,o,e);if(["tier_set","talent_target_scaling"].includes(e.data_type)){let a='<a href="#'+("override-profile-"+o.sorted_data_keys.indexOf(t))+'">';return a+=E(t,o,e),a+="</a>",a}if(["soulbinds"].includes(e.data_type)){let a='<a href="#'+t+'">';return a+=E(t,o,e),a+="</a>",a}if("wowhead"==e.tooltip_engine){let a=document.createElement("a");if(a.href="https://"+("en"===e.language?"www":e.language)+".wowhead.com/",o.hasOwnProperty("item_ids")&&o.item_ids.hasOwnProperty(t)){if(a.href+="item="+o.item_ids[t]+"/"+b(t),void 0!==o.simulated_steps){let e=o.simulated_steps[o.simulated_steps.length-1];"string"==typeof e&&e.indexOf("_")>-1&&(e=e.split("_")[1]),a.href+="&ilvl="+e}}else if(o.hasOwnProperty("spell_ids")&&o.spell_ids.hasOwnProperty(t))a.href+="spell="+o.spell_ids[t]+"/"+b(t);else if("talents"===e.data_type){if("0"===t[1])return t[1];a.href+="spell="+o.talent_data[t[0]][t[1]].spell_id}return"talents"===e.data_type?a.appendChild(document.createTextNode(t[1])):a.appendChild(document.createTextNode(E(t,o,e))),a.outerHTML}if("wowdb"==e.tooltip_engine){let a,l=document.createElement("a");l.href="http://www.wowdb.com/";try{l.href+="items/"+o.item_ids[t]}catch(e){n&&(console.log(e),console.log("We're probably looking at a spell."))}if(l.href.indexOf("items")>-1){let e=o.simulated_steps[o.simulated_steps.length-1];"string"==typeof e&&e.indexOf("_")>-1&&(e=e.split("_")[1]),l.href+="?itemLevel="+e}try{l.href+="spells/"+o.spell_ids[t]}catch(e){n&&(console.log(e),console.log("We're probably looking at an item."))}if("talents"===e.data_type){if("0"===t[1])return t[1];l.href+="spells/"+o.talent_data[t[0]][t[1]].spell_id}return l.dataset.tooltipHref=l.href,a="talents"===e.data_type?t[1]:E(t,o,e),l.appendChild(document.createTextNode(a)),l.outerHTML}}function y(e){e.setTitle({text:"Wrong chart setup"},{text:"Missing 'data-chart-id', 'data-wow-class' or 'data-wow-spec'. See <a href=\"https://github.com/Bloodmallet/bloodmallet_web_frontend/wiki/How-to-import-charts\">wiki</a>"})}function b(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function x(r){if(n&&console.log("update_chart_style"),"highcharts"==r.chart_engine||"highcharts_old"==r.chart_engine){let n="https://bloodmallet.com/";if(void 0!==r.chart_id?n+="chart/"+r.chart_id:void 0!==r.wow_class&&void 0!==r.wow_spec&&void 0!==r.data_type&&r.fight_style&&(n+="chart/"+r.wow_class+"/"+r.wow_spec+"/"+r.data_type+"/"+r.fight_style),"secondary_distributions"===r.data_type)return{accessibility:{enabled:!1},credits:{enabled:!1},chart:{renderTo:"scatter_plot_chart",type:"scatter3d",backgroundColor:null,className:"mx-auto",animation:!1,height:800,width:800,options3d:{enabled:!0,alpha:10,beta:30,depth:800,fitToPlot:!1}},legend:{enabled:!0,backgroundColor:r.background_color,borderColor:r.font_color,borderWidth:1,align:"right",verticalAlign:"middle",layout:"vertical",itemStyle:{color:r.font_color},itemHoverStyle:{color:r.font_color}},plotOptions:{series:{animation:!1,dataLabels:{allowOverlap:!0,style:{color:r.font_color,fontSize:r.font_size,fontWeight:"400",textOutline:""}},events:{legendItemClick:function(){return!1}}}},series:[],title:{text:"Loading data...",useHTML:!0,style:{color:r.font_color,fontSize:l}},subtitle:{text:'...from <a href="https://bloodmallet.com">bloodmallet</a>',useHTML:!0,style:{color:r.font_color,fontSize:l}},tooltip:{headerFormat:"",pointFormatter:function(){return'<table class="">                <thead>                  <tr>                    <th scope="col"></th>                    <th scope="col">Absolute</th>                    <th scope="col">Relative</th>                  </tr>                </thead>                <tbody>                  <tr>                    <th scope="row">DPS</th>                    <td>'+Intl.NumberFormat().format(this.dps)+"</td>                    <td>"+Math.round(this.dps/this.dps_max*1e4)/100+'%</td>                  </tr>                  <tr>                    <th scope="row">Crit</th>                    <td>'+Intl.NumberFormat().format(this.stat_crit)+"</td>                    <td>"+this.name.split("_")[0]+'%</td>                  </tr>                  <tr>                    <th scope="row">Haste</th>                    <td>'+Intl.NumberFormat().format(this.stat_haste)+"</td>                    <td>"+this.name.split("_")[1]+'%</td>                  </tr>                  <tr>                    <th scope="row">Mastery</th>                    <td>'+Intl.NumberFormat().format(this.stat_mastery)+"</td>                    <td>"+this.name.split("_")[2]+'%</td>                  </tr>                  <tr>                    <th scope="row">Versatility</th>                    <td>'+Intl.NumberFormat().format(this.stat_vers)+"</td>                    <td>"+this.name.split("_")[3]+"%</td>                  </tr>                </tbody>              </table>"},useHTML:!0,borderColor:r.background_color},xAxis:{min:0,max:80,tickInterval:20,startOnTick:!0,endOnTick:!0,title:"",labels:{enabled:!1},gridLineWidth:1,gridLineColor:r.axis_color},yAxis:{min:-10,max:70,tickInterval:20,startOnTick:!0,endOnTick:!0,title:"",labels:{enabled:!1},gridLineWidth:1,gridLineColor:r.axis_color},zAxis:{min:10,max:90,tickInterval:20,startOnTick:!0,endOnTick:!0,title:"",labels:{enabled:!1},reversed:!0,gridLineWidth:1,gridLineColor:r.axis_color}};if("talent_target_scaling"===r.data_type)return{accessibility:{enabled:!1},credits:{href:n,text:"bloodmallet",style:{fontSize:l}},chart:{backgroundColor:null,animation:!1,height:650},colors:e,legend:{enabled:!0,backgroundColor:r.background_color,borderColor:r.font_color,borderWidth:1,align:"center",verticalAlign:"top",layout:"horizontal",itemStyle:{color:r.font_color},itemHoverStyle:{color:r.font_color}},plotOptions:{series:{animation:!1,connectNulls:!0,dataLabels:{allowOverlap:!0,style:{color:r.font_color,fontSize:r.font_size,fontWeight:"400",textOutline:""}},events:{legendItemClick:function(){return!1}}}},series:[],title:{text:"Loading data...",useHTML:!0,style:{color:r.font_color,fontSize:l}},subtitle:{text:'...from <a href="https://bloodmallet.com">bloodmallet</a>',useHTML:!0,style:{color:r.font_color,fontSize:l}},xAxis:{tickInterval:1,title:{text:"Target count",style:{color:o}},labels:{enabled:!0,style:{color:o}},gridLineWidth:1,gridLineColor:r.axis_color},yAxis:{title:{text:"DPS",style:{color:o}},labels:{enabled:!0,style:{color:o}},gridLineWidth:1,gridLineColor:r.axis_color}};let i=r.background_color,s=r.axis_color,d=r.font_color,u={accessibility:{enabled:!1},chart:{type:"bar",backgroundColor:i,style:{fontFamily:'-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"'}},colors:e,credits:{href:n,text:"bloodmallet",style:{fontSize:l}},legend:{align:"right",backgroundColor:i,borderColor:s,borderWidth:1,floating:!1,itemMarginBottom:3,itemMarginTop:0,layout:"vertical",reversed:!0,shadow:!1,verticalAlign:"middle",x:0,y:0,itemStyle:{color:d},itemHoverStyle:{color:d},title:{text:" ",style:{color:o}},symbolRadius:0},plotOptions:{series:{animation:!1,stacking:"normal",borderColor:t,events:{legendItemClick:function(){return!1}},style:{textOutline:!1,fontSize:l},point:{events:{click:function(e){var t=this.series.yAxis;t.removePlotLine("helperLine"),t.addPlotLine({value:this.stackY,color:r.font_color,width:2,id:"helperLine",zIndex:5,label:{text:this.series.name+" "+this.category,style:{color:r.font_color,fontSize:l},align:"left",verticalAlign:"bottom",rotation:0,y:-5}})}}}}},series:[],title:{text:"Loading data...",useHTML:!0,style:{color:d,fontSize:l}},subtitle:{text:'...from <a href="https://bloodmallet.com">bloodmallet</a>',useHTML:!0,style:{color:d,fontSize:l}},tooltip:{headerFormat:"<b>{point.x}</b>",shared:!0,backgroundColor:t,borderColor:a,style:{color:o,fontSize:l},useHTML:!0},xAxis:{categories:[],labels:{useHTML:!0,style:{color:o,fontSize:l}},gridLineWidth:0,gridLineColor:a,lineColor:a,tickColor:a},yAxis:[{labels:{style:{color:a}},min:0,stackLabels:{enabled:!0,formatter:function(){return Intl.NumberFormat().format(this.total)},style:{color:o,textOutline:!1,fontSize:l,fontWeight:"normal"}},title:{text:"absolute"===r.value_style?c:h,style:{color:a}},gridLineWidth:1,gridLineColor:a},{linkedTo:0,opposite:!0,labels:{style:{color:a}},min:0,stackLabels:{enabled:!0,formatter:function(){return Intl.NumberFormat().format(this.total)},style:{color:o,textOutline:!1,fontSize:l,fontWeight:"normal"}},title:{text:"absolute"===r.value_style?c:h,style:{color:a}},gridLineWidth:1,gridLineColor:a}]};return u.tooltip.formatter=function(){let e=document.createElement("div");e.style.margin="-4px -7px -7px -7px",e.style.padding="3px 3px 6px 3px",e.style.backgroundColor="transparent"!==i?i:t,"highcharts_old"===r.chart_engine&&(e.style.margin="-7px");let o=document.createElement("div");e.appendChild(o),o.style.marginLeft="9px",o.style.marginRight="9px",o.style.marginBottom="6px",o.style.fontWeight="700",o.innerHTML=this.x;let a=0;for(var l=this.points.length-1;l>=0;l--){a+=this.points[l].y;let t,o=!1,n=0;for(let e of this.points)0!==e.y&&0!==n&&n!==e.y?o=!0:0!==e.y&&0===n&&(n=e.y);if("talents"!==r.data_type){let e=(new DOMParser).parseFromString(this.x,"text/html").body.firstChild.innerText;if(!r.data.data.hasOwnProperty(e)){let t;for(let o of Object.keys(r.data.data))o.slice(o.indexOf("} ")+2)===e&&(t=o);void 0!==t&&(e=t)}void 0===e&&(e=this.x);let o=L(e,r.data,r);r.data.data.hasOwnProperty(o)&&(t=r.data.data[o].hasOwnProperty(this.points[l].series.name))}if(0!==this.points[l].y||t){let t=document.createElement("div");e.appendChild(t);let o=document.createElement("span");t.appendChild(o),o.style.marginLeft="9px",o.style.borderLeft="9px solid "+this.points[l].series.color,o.style.paddingLeft="4px",Number.isInteger(this.points[l].series.name)&&o.appendChild(document.createTextNode(this.points[l].series.name+":"));let n="";["soulbinds","races","talents"].includes(r.data_type)?n="":"relative"===r.value_style&&(n="%"),t.appendChild(document.createTextNode("  "+Intl.NumberFormat().format(a)+n))}}return e.outerHTML},u.tooltip.backgroundColor="transparent"!==i?i:t,u.tooltip.borderColor=s,u.tooltip.style.color=d,u.xAxis.labels.style.color=d,u.xAxis.gridLineColor=s,u.xAxis.lineColor=s,u.xAxis.tickColor=s,u.yAxis[0].labels.style.color=s,u.yAxis[0].stackLabels.style.color=d,u.yAxis[0].gridLineColor=s,u.yAxis[0].lineColor=s,u.yAxis[0].tickColor=s,u.yAxis[0].title.style.color=s,u.yAxis[1].labels.style.color=s,u.yAxis[1].stackLabels.style.color=d,u.yAxis[1].gridLineColor=s,u.yAxis[1].lineColor=s,u.yAxis[1].tickColor=s,u.yAxis[1].title.style.color=s,u.credits.style.color=d,u}}function w(){return["bloodmallet.com","127.0.0.1:8000"].includes(window.location.host)}function v(e,t){if(!w())return;if(n&&console.log("provide_meta_data"),["trinkets","covenants","conduits","soulbind_nodes","windfury_totem","power_infusion"].includes(e.data_type)){let e=document.getElementById("value_style_switch");null!=e&&(e.hidden=!1)}let o=document.getElementById("meta-info");null!=o&&(o.hidden=!1);for(let e in t.simc_settings){let o=document.createTextNode(t.simc_settings[e]),a=document.getElementById("c_"+e);null!=a&&(a.innerText="",a.appendChild(o))}let a=document.createElement("a");a.href="https://github.com/simulationcraft/simc/commit/"+t.simc_settings.simc_hash,a.innerText=t.simc_settings.simc_hash.substring(0,7);let l=document.getElementById("c_simc_hash");if(null!=l&&(l.innerText="",l.appendChild(a)),Object.keys(t).indexOf("profile")>-1){for(let e in t.profile.character)try{let o=document.getElementById("c_"+e);if(null!=o){let a;o.innerHTML="",a="soulbind"===e?document.createTextNode(t.profile.character[e].replaceAll(","," ").replaceAll("/"," ")):document.createTextNode(t.profile.character[e].split(" ").map((e=>e[0].toUpperCase()+e.substring(1))).join(" ")),o.appendChild(a)}}catch(e){}const o=void 0!==t.profile.character.talents?t.profile.character.talents:"0000000";let a=document.getElementById("c_talents");null!=a&&(a.innerHTML="",a.appendChild(O(o,"base")));for(let o in t.profile.items){let a=document.createElement("a");a.href="",a.href="https://"+("en"===e.language?"www":e.language)+".wowhead.com/",a.href+="item="+t.profile.items[o].id;let l=[];try{l.push("bonus="+t.profile.items[o].bonus_id.split("/").join(":"))}catch(e){}try{t.profile.items[o].hasOwnProperty("ilevel")&&l.push("ilvl="+t.profile.items[o].ilevel)}catch(e){}l.length>0&&(a.href+="?"+l.join("&")),a.dataset.whIconSize="medium";let n=document.getElementById("c_"+o);null!=n&&(n.innerHTML="",n.appendChild(a))}}else{let e=document.getElementById("character-profile-label");null!=e&&(e.hidden=!0)}if(["tier_set","talent_target_scaling"].indexOf(e.data_type)>-1){let e=document.getElementById("post_chart");null!=e&&(e.hidden=!1);let o=document.getElementById("talent-information-div");if(null!=o&&""===o.textContent)for(const e of Object.keys(t.data_profile_overrides)){const a=t.data_profile_overrides[e],l=t.sorted_data_keys.indexOf(e);let n=document.createElement("h3");n.appendChild(document.createTextNode(e)),n.id="override-profile-"+l,o.appendChild(n);let r="";for(const e of a)e.startsWith("talents=")&&(r=e.split("=")[1]);let i=O(r,e);o.appendChild(i)}}if("soulbinds"===e.data_type){let o=document.getElementById("post_chart");o.hidden=!1,o.innerHTML="",Object.keys(t.covenant_ids).forEach((a=>{const l=t.covenant_ids[a];let n=document.createElement("h3");n.appendChild(document.createTextNode(E(a,t,e))),o.appendChild(n);let r=0;const i=t.sorted_data_keys;for(const a of i)if(t.covenant_mapping[a].indexOf(l)>-1){r+=1;let l=document.createElement("h4");l.appendChild(document.createTextNode(r+". "+E(a,t,e))),l.classList+="ml-3",l.id=a,o.appendChild(l);let n=document.createElement("p");n.classList+="ml-5";let i=[];const s=A(t.data[a],Math.max(...Object.values(t.data[a]))).split("+");for(const o of s){let a=document.createElement("a");a.href="https://"+("en"===e.language?"www":e.language)+".wowhead.com/",t.hasOwnProperty("spell_ids")&&t.spell_ids.hasOwnProperty(o)&&(a.href+="spell="+t.spell_ids[o]+"/"+b(o)),a.appendChild(document.createTextNode(E(o,t,e))),i.push(a)}for(let e=0;e<i.length;e++)0!==e&&n.appendChild(document.createTextNode(", ")),n.appendChild(i[e]);o.appendChild(n)}})),setTimeout((()=>{Object.keys(t.covenant_ids).forEach((a=>{const l=t.covenant_ids[a];let n=document.createElement("h3");n.appendChild(document.createTextNode(E(a,t,e))),o.appendChild(n);let r=0;const i=t.sorted_data_keys;for(const n of i)if(t.covenant_mapping[n].indexOf(l)>-1){r+=1;let l=document.createElement("h4");l.appendChild(document.createTextNode(r+". "+E(n,t,e))),l.classList+="ml-3",l.id=n,o.appendChild(l);let i=Object.values(t.data[n]).sort(((e,t)=>t-e)),d=i.map((e=>A(t.data[n],e))),c=document.createElement("div"),h=Highcharts.chart(c,x(e));h.title.attr({text:""}),h.subtitle.attr({text:""});let u=d.map((o=>o.split("+").reduce(((o,a)=>{let l=document.createElement("a");return l.href="https://"+("en"===e.language?"www":e.language)+".wowhead.com/",l.href+="spell="+t.spell_ids[a]+"/"+b(a),o+l.outerHTML}),"")));h.update({xAxis:{categories:u,labels:{step:1}}},!1),h.addSeries({data:i,color:s[a].color,showInLegend:!1},!1),o.appendChild(c),h.redraw(),setTimeout((()=>{c.style.height=200+30*d.length+"px",h.setSize(void 0,c.style.height)}),100)}}))}),5)}if("trinkets"===e.data_type){let e=document.getElementById("filter-itemlevels-options");if(null!=e){e.innerHTML="";let o=document.getElementById("chart");for(let a of t.simulated_steps){let t="step_"+a,l=document.createElement("div");l.className+=" form-check";let n=document.createElement("input");n.className+=" form-check-input",n.className+=" filter-itemlevels",n.type="checkbox",n.id=t,n.value=a,void 0===o.dataset.filterItemlevels?n.checked=!0:n.checked=-1===o.dataset.filterItemlevels.split(";").indexOf(a.toString()),l.appendChild(n);let r=document.createElement("label");r.className=" form-check-label",r.htmlFor=t,r.appendChild(document.createTextNode(a)),l.appendChild(r),e.appendChild(l),n.addEventListener("change",((e,t)=>{k(e.target.value,e.target.checked),bloodmallet_chart_import()}))}}let o=document.getElementById("filter-sources-options");if(null!=o){o.innerHTML="";let e=Object.values(t.data_sources).filter(((e,t,o)=>o.indexOf(e)===t)).sort();for(let t of e){let e="step_"+t.replaceAll(" ","_"),a=document.createElement("div");a.className+=" form-check";let l=document.createElement("input");l.className+=" form-check-input",l.className+=" filter-sources",l.type="checkbox",l.id=e,l.value=t,void 0===chart.dataset.filterSources?l.checked=!0:l.checked=-1===chart.dataset.filterSources.split(";").indexOf(t.toString()),a.appendChild(l);let n=document.createElement("label");n.className=" form-check-label",n.htmlFor=e,n.appendChild(document.createTextNode(t)),a.appendChild(n),o.appendChild(a),l.addEventListener("change",((e,t)=>{C(e.target.value,e.target.checked),bloodmallet_chart_import()}))}}}try{$WowheadPower.refreshLinks()}catch(e){}}function k(e,t){let o=document.getElementById("chart"),a=o.dataset.filterItemlevels;t?o.dataset.filterItemlevels=a.split(";").filter((t=>t!==e)).join(";"):void 0===a||0===a.length?o.dataset.filterItemlevels=e:o.dataset.filterItemlevels=a+";"+e}function C(e,t){let o=document.getElementById("chart"),a=o.dataset.filterSources;t?o.dataset.filterSources=a.split(";").filter((t=>t!==e)).join(";"):void 0===a||0===a.length?o.dataset.filterSources=e:o.dataset.filterSources=a+";"+e}function O(e,t){let o=document.createElement("iframe");return o.title=t,o.width=760,o.height=475,o.src="https://www.raidbots.com/simbot/render/talents/"+e+"?width=750",o}function E(e,t,o){n&&console.log("get_translated_name "+e);let a="";try{a=t.translations[e][i[o.language]]}catch(t){n&&(console.log(`No translation for ${e} found.`),console.log(t)),a=e}return n&&console.log("Translated name: "+a),void 0===a&&(a=e),a}function A(e,t){return Object.keys(e).find((o=>e[o]===t))}function L(e,t,o){n&&console.log("get_base_name_from_translation "+e);for(let a of Object.keys(t.translations))if(i[o.language]===A(t.translations[a],e))return n&&console.log("Base name: "+a),a;return e}this.init_charts=new function(){n&&console.log("init_charts");let e=document.querySelectorAll("div.bloodmallet_chart"),l=[];for(let t=0;t<e.length;t++){const o=e[t];if(l.indexOf(o.id)>-1)return void console.error("Multiple Elements use the same ID ('"+o.id+"'). Aborting bloodmallet_chart_import.js.");l.push(o.id)}for(let l=0;l<e.length;l++){let r;try{r=e[l].id}catch(e){return void console.error("Each .bloodmallet_chart needs an ID. Aborting bloodmallet_chart_import.js.")}const i=document.getElementById(e[l].id);if(i){let e={chart_id:void 0,wow_class:void 0,wow_spec:void 0,data_type:"trinkets",fight_style:"castingpatchwerk",covenant:"Kyrian",axis_color:a,background_color:t,font_color:o,limit:7,chart_engine:"highcharts",tooltip_engine:"wowhead",language:"en",value_style:"absolute",talent_target_scaling_min_target_count:-1,talent_target_scaling_max_target_count:-1,html_element:i};try{void 0!==bloodmallet.style.axis_color&&(e.axis_color=bloodmallet.style.axis_color),void 0!==bloodmallet.style.background_color&&(e.background_color=bloodmallet.style.background_color),void 0!==bloodmallet.style.font_color&&(e.font_color=bloodmallet.style.font_color),void 0!==bloodmallet.settings.entries&&(e.limit=bloodmallet.settings.entries),void 0!==bloodmallet.settings.chart_engine&&(e.chart_engine=bloodmallet.settings.chart_engine),void 0!==bloodmallet.settings.tooltip_engine&&(e.tooltip_engine=bloodmallet.settings.tooltip_engine),void 0!==bloodmallet.settings.language&&(e.language=bloodmallet.settings.language),void 0!==bloodmallet.settings.value_style&&(e.value_style=bloodmallet.settings.value_style)}catch(e){n&&console.log("Applying page wide settings failed or no page wide settings were found.")}i.getAttribute("data-entries")&&(e.limit=i.getAttribute("data-entries")),i.getAttribute("data-fight-style")&&(e.fight_style=i.getAttribute("data-fight-style")),i.getAttribute("data-type")&&(e.data_type=i.getAttribute("data-type")),i.getAttribute("data-covenant")&&(e.covenant=i.getAttribute("data-covenant")),i.getAttribute("data-background-color")&&(e.background_color=i.getAttribute("data-background-color")),i.getAttribute("data-font-color")&&(e.font_color=i.getAttribute("data-font-color")),i.getAttribute("data-axis-color")&&(e.axis_color=i.getAttribute("data-axis-color")),i.getAttribute("data-tooltip-engine")&&(e.tooltip_engine=i.getAttribute("data-tooltip-engine")),i.getAttribute("data-chart-engine")&&(e.chart_engine=i.getAttribute("data-chart-engine")),i.getAttribute("data-language")&&(e.language=i.getAttribute("data-language")),i.getAttribute("data-value-style")&&(e.value_style=i.getAttribute("data-value-style")),i.getAttribute("data-talent-target-scaling-min-target-count")&&(e.talent_target_scaling_min_target_count=parseInt(i.getAttribute("data-talent-target-scaling-min-target-count"))),i.getAttribute("data-talent-target-scaling-max-target-count")&&(e.talent_target_scaling_max_target_count=parseInt(i.getAttribute("data-talent-target-scaling-max-target-count")));let l=!0;i.getAttribute("data-chart-id")?e.chart_id=i.getAttribute("data-chart-id"):(i.getAttribute("data-wow-class")||(console.error("Required 'data-chart-id' or 'data-wow-class' attribute wasn't found in "+r+"."),l=!1),e.wow_class=i.getAttribute("data-wow-class"),i.getAttribute("data-wow-spec")||(console.error("Required 'data-chart-id' or 'data-wow-spec' attribute wasn't found in "+r+"."),l=!1),e.wow_spec=i.getAttribute("data-wow-spec"));let s=x(e),d=!1;if("highcharts"==e.chart_engine)try{d=Highcharts.chart(r,s)}catch(e){return console.log("When trying to create a highcharts chart the following error occured. Did you include the necessary Highcharts scripts?"),void console.log(e)}else if("highcharts_old"==e.chart_engine)try{let e=s;e.chart.renderTo=r,d=new Highcharts.Chart(e)}catch(e){return console.log("When trying to create a highcharts_old chart the following error occured. Did you include the necessary Highcharts scripts?"),void console.log(e)}l?u(e):y(d),setTimeout(p,1,e,i,d,0)}}}}document.addEventListener("DOMContentLoaded",(function(){bloodmallet_chart_import()}));