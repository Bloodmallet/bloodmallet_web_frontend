function bloodmallet_chart_import(){const t=["#7cb5ec","#d9d9df","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"],e="#343a40",o="#f8f9fa",a="#828282",l="1.1rem",r=!1,i="https://bloodmallet.com/chart/get/",n={cn:"cn_CN",en:"en_US",de:"de_DE",es:"es_ES",fr:"fr_FR",it:"it_IT",ko:"ko_KR",pt:"pt_BR",ru:"ru_RU","zh-hans":"cn_CN"},s={Kyrian:{id:1,color:"#69ccf0"},Venthyr:{id:2,color:"#c41f3b"},"Night Fae":{id:3,color:"#a330c9"},Necrolord:{id:4,color:"#abd473"}},d={unholy:"#abd473",frost:"#69ccf0",blood:"#c41f3b"},c="Î” Damage per second",h="% Damage per second";function u(t){let e=t.chart_id,o=t.data_type,a=t.fight_style,l=t.wow_class,n=t.wow_spec;try{if(m(t))return}catch(t){r}let s=a;s+="/"+l,s+="/"+n;let d="";d=e?i+e:i+o+"/"+s;let c=new XMLHttpRequest;c.open("GET",d,!0),c.onload=function(e){if(4===c.readyState)if(200===c.status){JSON.parse(c.responseText);t.html_element.dataset.loadedData=c.responseText}else console.error(c.statusText)},c.onerror=function(t){console.error("Fetching data from bloodmallet.com encountered an error, ",t)},c.send(null)}function m(t){return JSON.parse(t.html_element.dataset.loadedData)}function p(t,e,o,a){let l=t.data_type,i=t.limit,n=t.chart_engine,h=!1;try{h=m(t)}catch(l){return void(a<30&&setTimeout(p,200,t,e,o,a+1))}if(t.data=h,o.update({accessibility:{enable:!1}},!1),!0===h.error||"error"===h.status)return function(t,e){let o=t;if(o.innerHTML="","error"===e.status){let t=document.createElement("p");t.innerText=e.message,o.appendChild(t)}else{let t=document.createElement("p");t.innerText="An error occured during simulation.",o.appendChild(t);let a=document.createElement("ul"),l=document.createElement("li");l.textContent="Title: "+(e.title?e.title:"~"),a.appendChild(l);let r=document.createElement("li");r.textContent="Spec: "+e.wow_spec+" "+e.wow_class,a.appendChild(r);let i=document.createElement("li");i.textContent="Type: "+e.simulation_type,a.appendChild(i);let n=document.createElement("li");n.textContent="Fight style: "+e.fight_style,a.appendChild(n);let s=document.createElement("li");s.textContent="ID: "+e.id,a.appendChild(s);let d=document.createElement("li");d.textContent="Custom profile:",a.appendChild(d),d.appendChild(document.createElement("br"));let c=document.createElement("textarea");c.value=e.custom_profile,c.placeholder="No custom profile",c.style.width="100%",c.classList.add("form-control"),d.appendChild(c);let h=document.createElement("li");h.textContent="Log:",a.appendChild(h),h.appendChild(document.createElement("br"));let u=document.createElement("textarea");u.value=e.log,u.placeholder="No log available",u.style.width="100%",u.classList.add("form-control"),h.appendChild(u),o.appendChild(a)}}(e,h);if(wow_class=h.simc_settings.class,wow_spec=h.simc_settings.spec,fight_style=h.simc_settings.fight_style,t.data_type=l=h.data_type,("legendaries"===t.data_type||"tier_set"===t.data_type)&&(t.value_style="absolute"),function(t,e){if(!["bloodmallet.com","127.0.0.1:8000"].includes(window.location.host))return;r;["trinkets","covenants","conduits","soulbind_nodes"].includes(t.data_type)&&(document.getElementById("value_style_switch").hidden=!1);document.getElementById("meta-info").hidden=!1;for(let t in e.simc_settings){let o=document.createTextNode(e.simc_settings[t]),a=document.getElementById("c_"+t);a.innerText="",a.appendChild(o)}let o=document.createElement("a");o.href="https://github.com/simulationcraft/simc/commit/"+e.simc_settings.simc_hash,o.innerText=e.simc_settings.simc_hash.substring(0,7);let a=document.getElementById("c_simc_hash");a.innerText="",a.appendChild(o);for(let t in e.profile.character)try{let o,a=document.getElementById("c_"+t);a.innerHTML="",o="soulbind"===t?document.createTextNode(e.profile.character[t].replaceAll(","," ").replaceAll("/"," ")):document.createTextNode(w(e.profile.character[t])),a.appendChild(o)}catch(t){}const l=void 0!==e.profile.character.talents?e.profile.character.talents:"0000000";let i=document.getElementById("c_talents");i.innerHTML="",i.appendChild(C(l,"base"));for(let o in e.profile.items){let a=document.createElement("a");a.href="",a.href="https://"+("en"===t.language?"www":t.language)+".wowhead.com/",a.href+="item="+e.profile.items[o].id;let l=[];try{l.push("bonus="+e.profile.items[o].bonus_id.split("/").join(":"))}catch(t){}try{e.profile.items[o].hasOwnProperty("ilevel")&&l.push("ilvl="+e.profile.items[o].ilevel)}catch(t){}l.length>0&&(a.href+="?"+l.join("&")),a.dataset.whIconSize="medium";let r=document.getElementById("c_"+o);r.innerHTML="",r.appendChild(a)}if(["tier_set","talent_target_scaling"].indexOf(t.data_type)>-1){document.getElementById("post_chart").hidden=!1;let t=document.getElementById("talent-information-div");for(const o of Object.keys(e.data_profile_overrides)){const a=e.data_profile_overrides[o],l=e.sorted_data_keys.indexOf(o);let r=document.createElement("h3");r.appendChild(document.createTextNode(o)),r.id="override-profile-"+l,t.appendChild(r);let i="";for(const t of a)t.startsWith("talents=")&&(i=t.split("=")[1]);let n=C(i,o);t.appendChild(n)}}if("soulbinds"===t.data_type){let o=document.getElementById("post_chart");o.hidden=!1,o.innerHTML="",Object.keys(e.covenant_ids).forEach((a=>{const l=e.covenant_ids[a];let r=document.createElement("h3");r.appendChild(document.createTextNode(k(a,e,t))),o.appendChild(r);let i=0;const n=e.sorted_data_keys;for(const a of n)if(e.covenant_mapping[a].indexOf(l)>-1){i+=1;let l=document.createElement("h4");l.appendChild(document.createTextNode(i+". "+k(a,e,t))),l.classList+="ml-3",l.id=a,o.appendChild(l);let r=document.createElement("p");r.classList+="ml-5";let n=[];const s=O(e.data[a],Math.max(...Object.values(e.data[a]))).split("+");for(const o of s){let a=document.createElement("a");a.href="https://"+("en"===t.language?"www":t.language)+".wowhead.com/",e.hasOwnProperty("spell_ids")&&e.spell_ids.hasOwnProperty(o)&&(a.href+="spell="+e.spell_ids[o]+"/"+y(o)),a.appendChild(document.createTextNode(k(o,e,t))),n.push(a)}for(let t=0;t<n.length;t++)0!==t&&r.appendChild(document.createTextNode(", ")),r.appendChild(n[t]);o.appendChild(r)}})),setTimeout((()=>{Object.keys(e.covenant_ids).forEach((a=>{const l=e.covenant_ids[a];let r=document.createElement("h3");r.appendChild(document.createTextNode(k(a,e,t))),o.appendChild(r);let i=0;const n=e.sorted_data_keys;for(const r of n)if(e.covenant_mapping[r].indexOf(l)>-1){i+=1;let l=document.createElement("h4");l.appendChild(document.createTextNode(i+". "+k(r,e,t))),l.classList+="ml-3",l.id=r,o.appendChild(l);let n=Object.values(e.data[r]).sort(((t,e)=>e-t)),d=n.map((t=>O(e.data[r],t))),c=document.createElement("div"),h=Highcharts.chart(c,b(t));h.title.attr({text:""}),h.subtitle.attr({text:""});let u=d.map((o=>o.split("+").reduce(((o,a)=>{let l=document.createElement("a");return l.href="https://"+("en"===t.language?"www":t.language)+".wowhead.com/",l.href+="spell="+e.spell_ids[a]+"/"+y(a),o+l.outerHTML}),"")));h.update({xAxis:{categories:u,labels:{step:1}}},!1),h.addSeries({data:n,color:s[a].color,showInLegend:!1},!1),o.appendChild(c),h.redraw(),setTimeout((()=>{c.style.height=200+30*d.length+"px",h.setSize(void 0,c.style.height)}),100)}}))}),5)}if("trinkets"===t.data_type){let t=document.getElementById("filter-itemlevels-options");t.innerHTML="";let o=document.getElementById("chart");for(let a of e.simulated_steps){let e="step_"+a,l=document.createElement("div");l.className+=" form-check";let r=document.createElement("input");r.className+=" form-check-input",r.className+=" filter-itemlevels",r.type="checkbox",r.id=e,r.value=a,void 0===o.dataset.filterItemlevels?r.checked=!0:r.checked=-1===o.dataset.filterItemlevels.split(";").indexOf(a.toString()),l.appendChild(r);let i=document.createElement("label");i.className=" form-check-label",i.htmlFor=e,i.appendChild(document.createTextNode(a)),l.appendChild(i),t.appendChild(l),r.addEventListener("change",((t,e)=>{x(t.target.value,t.target.checked),bloodmallet_chart_import()}))}let a=document.getElementById("filter-sources-options");a.innerHTML="";let l=Object.values(e.data_sources).filter(((t,e,o)=>o.indexOf(t)===e)).sort();for(let t of l){let e="step_"+t.replaceAll(" ","_"),l=document.createElement("div");l.className+=" form-check";let r=document.createElement("input");r.className+=" form-check-input",r.className+=" filter-sources",r.type="checkbox",r.id=e,r.value=t,void 0===o.dataset.filterSources?r.checked=!0:r.checked=-1===o.dataset.filterSources.split(";").indexOf(t.toString()),l.appendChild(r);let i=document.createElement("label");i.className=" form-check-label",i.htmlFor=e,i.appendChild(document.createTextNode(t)),l.appendChild(i),a.appendChild(l),r.addEventListener("change",((t,e)=>{v(t.target.value,t.target.checked),bloodmallet_chart_import()}))}}try{$WowheadPower.refreshLinks()}catch(t){}}(t,h),"secondary_distributions"===l)return function(t,e,o){r;let a=e.id,l=(t.chart_id,t.fight_style),i=t.wow_class,n=t.wow_spec,s=(t.chart_engine,!1);s=m(t),i=s.simc_settings.class,n=s.simc_settings.spec,l=s.simc_settings.fight_style;let d=b(t),c=!1;if("highcharts"==t.chart_engine)try{c=Highcharts.chart(a,d)}catch(t){return console.log("When trying to create a highcharts chart the following error occurred. Did you include the necessary Highcharts scripts?"),void console.log(t)}else if("highcharts_old"==t.chart_engine)try{let t=d;t.chart.renderTo=a,c=new Highcharts.Chart(t)}catch(t){return console.log("When trying to create a highcharts_old chart the following error occurred. Did you include the necessary Highcharts scripts?"),void console.log(t)}o=void 0,o=c;let h;h=Object.keys(s.data)[0];let u=s.data[h][s.sorted_data_keys[h][0]],p=s.data[h][s.sorted_data_keys[h][s.sorted_data_keys[h].length-1]],g=f(100,0,100),_=f(0,0,100),y={name:Intl.NumberFormat().format(u)+" DPS",color:"rgb("+g[0]+","+g[1]+","+g[2]+")",data:[]};for(let e of Object.keys(s.data[h])){let o,a=s.data[h][e],l=f(a,p,u),r=1,i="#232227",n=5;if(u===a&&(r=3,n=8,i=t.font_color),e.indexOf("70")>-1)switch(o={enabled:!0,allowOverlap:!0},e.indexOf("70")){case 0:o.format="Crit",o.verticalAlign="top";break;case 3:o.format="Haste";break;case 6:o.format="Mastery",o.verticalAlign="top";break;case 9:o.format="Versatility",o.verticalAlign="top"}const d=s.secondary_sum;let c=parseInt(e.split("_")[0]),m=parseInt(e.split("_")[1]),g=parseInt(e.split("_")[2]),_=parseInt(e.split("_")[3]);y.data.push({x:Math.sqrt(3)/2*(c+1/3*m),y:Math.sqrt(2/3)*m,z:g+.5*c+.5*m,name:e,color:"rgb("+l[0]+","+l[1]+","+l[2]+")",dps:a,dps_max:u,dps_min:p,stat_crit:c*d/100,stat_haste:m*d/100,stat_mastery:g*d/100,stat_vers:_*d/100,stat_sum:d,marker:{radius:n,lineColor:i,lineWidth:r},dataLabels:o})}for(;o.series[0];)o.series[0].remove(!1);o.addSeries(y,!1),o.addSeries({name:Intl.NumberFormat().format(p)+" DPS",color:"rgb("+_[0]+","+_[1]+","+_[2]+")"},!1);let x=s.timestamp,v=x.split("-")[0],w=x.split("-")[1],C=x.split("-")[2].split(" ")[0],k=x.split(" ")[1].split(":")[0],O=x.split(":")[1],A="Last updated ",L=new Date-new Date(Date.UTC(v,w-1,C,k,O)),T=Math.floor(L/24/3600/1e3);T>0&&(A+=`${T}d `);let E=Math.floor(L/3600/1e3)-24*T;A+=`${E}h ago`,o.redraw(),function(t){function e(e){var a=(e=o.pointer.normalize(e)).chartX,l=e.chartY,r=o.options.chart.options3d.alpha,i=o.options.chart.options3d.beta,n=5;function s(t){t=o.pointer.normalize(t),o.update({chart:{options3d:{alpha:r+(t.chartY-l)/n,beta:i+(a-t.chartX)/n}}},void 0,void 0,!1)}o.unbindDragMouse=t.addEvent(document,"mousemove",s),o.unbindDragTouch=t.addEvent(document,"touchmove",s),t.addEvent(document,"mouseup",o.unbindDragMouse),t.addEvent(document,"touchend",o.unbindDragTouch)}t.addEvent(o.container,"mousedown",e),t.addEvent(o.container,"touchstart",e)}(Highcharts)}(t,e,o);if("talent_target_scaling"===l)return function(t,e,o){r;let a=e.id,l=(t.chart_id,t.fight_style),i=t.wow_class,n=t.wow_spec,s=(t.chart_engine,m(t));document.getElementById("post_chart").hidden=!1,i=s.profile.character.class,n=s.profile.character.spec,l=s.simc_settings.fight_style;let d=b(t),c=!1;if("highcharts"==t.chart_engine)try{c=Highcharts.chart(a,d)}catch(t){return console.log("When trying to create a highcharts chart the following error occurred. Did you include the necessary Highcharts scripts?"),void console.log(t)}else if("highcharts_old"==t.chart_engine)try{let t=d;t.chart.renderTo=a,c=new Highcharts.Chart(t)}catch(t){return console.log("When trying to create a highcharts_old chart the following error occurred. Did you include the necessary Highcharts scripts?"),void console.log(t)}o=void 0,o=c;for(;o.series[0];)o.series[0].remove(!1);for(const e of s.sorted_data_keys){const a=s.data[e],l=Object.keys(a);let r=-1;r=t.talent_target_scaling_min_target_count>-1?t.talent_target_scaling_min_target_count:Math.min(...l.map((t=>parseInt(t))));let i=-1;i=t.talent_target_scaling_max_target_count>-1?t.talent_target_scaling_max_target_count:Math.max(...l.map((t=>parseInt(t))));let n=[];for(let t=r;t<=i;t++)l.indexOf(t.toString())>=-1?n.push([t,a[t]]):n.push([t,null]);let d={name:e,data:n};o.addSeries(d,!1),o.update({xAxis:{min:r-.5,max:i+.5}})}o.redraw()}(t,e,o);l=h.data_type;const u=h;let A,L,T={};A=Object.keys(u).indexOf("sorted_data_keys")>-1?u.sorted_data_keys.slice(0,i):Object.keys(u.data),L=["races","talents","soulbinds","tier_set"].includes(l)?0:["legendaries","soulbind_nodes","covenants","domination_shards"].includes(l)?u.data.baseline:u.data.baseline[u.simulated_steps[u.simulated_steps.length-1]];for(let t of Object.keys(u.data))"{"===t[0]&&"}"===t[t.length-1]&&(T[t]=u.data[t]);let E,I=[];if(I="soulbinds"===l?void 0:"tier_set"===l?["4p","2p","no tier"]:u.simulated_steps,"trinkets"===l){if(void 0!==t.html_element.dataset.filterItemlevels){const e=t.html_element.dataset.filterItemlevels.split(";");I=I.filter((t=>-1===e.indexOf(t.toString())))}if(A=A.filter((t=>I.some((e=>void 0!==u.data[t][e])))),void 0!==t.html_element.dataset.filterActivePassive){const e=t.html_element.dataset.filterActivePassive.split(";");let o=[];e.map((t=>{"active"===t?o.push(!0):"passive"===t&&o.push(!1)})),A=A.filter((t=>-1===o.indexOf(u.data_active[t])))}if(void 0!==t.html_element.dataset.filterSources){const e=t.html_element.dataset.filterSources.split(";");A=A.filter((t=>-1===e.indexOf(u.data_sources[t])))}let e=[];for(let t of A){let o;for(let e of I)(void 0===o&&void 0!==u.data[t][e]||void 0!==u.data[t][e]&&u.data[t][e]>o)&&(o=u.data[t][e]);e.push([t,o])}e.sort(((t,e)=>e[1]-t[1])),A=e.map((t=>t[0]))}for(o.setTitle({text:u.title},{text:u.subtitle},!1);o.series[0];)o.series[0].remove(!1);if(E=["talents"].indexOf(l)>-1?A.map((e=>{let o=[];for(let a=0;a<e.length;a++)o.push(_(t,(a+1).toString()+e[a],u));return o.join("")})):["tier_set","talent_target-scaling"].indexOf(l)>-1?A.map((e=>_(t,e,u))):A.map((e=>{let o=e.indexOf("} ")>-1?e.slice(e.indexOf("} ")+2,e.length):e;return o=o.indexOf(" +")>-1?o.slice(0,o.indexOf(" +")):o,_(t,o,u)})),"highcharts"==n?o.update({xAxis:{categories:E}},!1):"highcharts_old"==n&&o.xAxis[0].setCategories(E,!1),I){let e={};for(const o in u.data)if(u.data.hasOwnProperty(o)){const a=u.data[o];e[o]={};let r=L;"conduits"===l&&(r=u.data.baseline[u.covenant_mapping[o]]);for(let l=I.length-1;l>=0;l--){const i=I[l];let n=a.hasOwnProperty(t.covenant)?a[t.covenant]:a;Number.isInteger(n)?(e[o][i]=Math.max(n-r,0),r=0===e[o][i]?r:n):n.hasOwnProperty(i)?(e[o][i]=Math.max(n[i]-r,0),r=0===e[o][i]?r:n[i]):e[o][i]=0}}r;for(const a of I){let l=[];for(let o=0;o<A.length;o++){const r=A[o];let i=g(t,e[r][a],L);l.push(i)}let r=a;o.addSeries({data:l,name:r},!1)}}else if(["soulbind_nodes","covenants"].includes(l)){var S=[];for(let e=0;e<A.length;e++){let o=A[e],a=u.data[o]-L;S.push(g(t,a,L))}o.addSeries({data:S,name:"Data",showInLegend:!1},!1)}else if(["legendaries"].includes(l)){let e=[],a="{"+u.profile.character.covenant+"}",l={};for(let t of Object.keys(T))l[t]=[];l[a]=[];for(let o of A){let r=L;if(o.indexOf("} ")>-1){let e=o.slice(0,o.indexOf("} ")+1);r=T[e],l[e].push(g(t,r,L));for(let t of Object.keys(l))t!==e&&l[t].push(0)}else for(let e of Object.keys(l))e!==a?l[e].push(0):l[e].push(g(t,r,r));let i=u.data[o]-r;e.push(g(t,i,r))}o.addSeries({data:e,name:"Legendary effect",showInLegend:!0,color:"#ff7d0a"},!1);let r={night_fae:"Night Fae",necrolord:"Necrolord",venthyr:"Venthyr",kyrian:"Kyrian"};for(let t of Object.keys(l))o.addSeries({data:l[t],name:r[t.slice(1,t.length-1)],showInLegend:!0,color:s[r[t.slice(1,t.length-1)]].color},!1)}else if(["domination_shards"].includes(l)){for(let e of Object.keys(d)){let a=[];for(let o of A){let l=o,r=L;if(o.indexOf(" +")>-1&&(l=o.split(" +")[0],r=u.data[l]),u.shard_type[l]===e){let e=u.data[o]-r;a.push(g(t,e,r))}else a.push(g(t,0,r))}o.addSeries({data:a,name:e+(A[0].indexOf(" +")>-1?" set":""),showInLegend:!0,color:d[e]},!1)}if(A[0].indexOf(" +")>-1){let e=[];for(let o of A){let a=o.split(" +")[0],l=u.data[a]-L;e.push(g(t,l,L))}o.addSeries({data:e,name:"shard",showInLegend:!0,color:"#ff7d0a"},!1)}}else if(["soulbinds"].includes(l)){for(const e of Object.keys(s).sort().reverse()){const a=s[e].id;let l=[];for(const t of A){let e=0;u.covenant_mapping[t][0]===a&&(e=Math.max(...Object.values(u.data[t]))),l.push(e)}o.addSeries({data:l,name:k(e,u,t),showInLegend:!0,color:s[e].color},!1)}o.yAxis[0].options.title.text=c,o.yAxis[1].options.title.text=c}else{S=[];for(let t=0;t<A.length;t++){let e=A[t],o=u.data[e];S.push(o)}o.addSeries({data:S,name:"DPS",showInLegend:!1},!1)}["trinkets"].indexOf(l)>-1?o.legend.title.attr({text:"Itemlevel"}):"races"!==l&&"domination_shards"!==l||o.legend.title.attr({text:""}),"highcharts_old"==n&&o.reflow(),e.style.height=200+30*A.length+"px","highcharts"==n&&o.setSize(void 0,e.style.height),"wowdb"==t.tooltip_engine?setTimeout((()=>{!function(t){r;try{CurseTips["wowdb-tooltip"].watchElements(document.getElementById(t).getElementsByTagName("a"))}catch(t){console.log("Setting wowdb (CurseTips) tooltips failed. Error: ",t)}}(e.id),o.redraw()}),1):"wowhead"==t.tooltip_engine?setTimeout((()=>{window.$WowheadPower.refreshLinks(),o.redraw()}),1):setTimeout((()=>{o.redraw()}),1)}function g(t,e,o){return"absolute"===t.value_style?e:"relative"===t.value_style?Math.round(1e4*e/o)/100:void console.error("Unknown value-style",t.value_style)}function f(t,e,o){let a=[0,255,255],l=[255,255,0],r=[255,0,0],i=0,n=0;for(let t=0;t<3;t++)i+=Math.abs(r[t]-l[t]),n+=Math.abs(l[t]-a[t]);let s=e+(o-e)*(n/(n+i));if(t>=s){let e=(t-s)/(o-s);return[Math.floor(r[0]*e+l[0]*(1-e)),Math.floor(r[1]*e+l[1]*(1-e)),Math.floor(r[2]*e+l[2]*(1-e))]}{let o=(t-e)/(s-e);return[Math.floor(l[0]*o+a[0]*(1-o)),Math.floor(l[1]*o+a[1]*(1-o)),Math.floor(l[2]*o+a[2]*(1-o))]}}function _(t,e,o){if("wowhead"!=t.tooltip_engine&&"wowdb"!=t.tooltip_engine)return k(e,o,t);if(["races","phials","potions"].includes(t.data_type))return k(e,o,t);if(["tier_set","talent_target_scaling"].includes(t.data_type)){let a='<a href="#'+("override-profile-"+o.sorted_data_keys.indexOf(e))+'">';return a+=k(e,o,t),a+="</a>",a}if(["soulbinds"].includes(t.data_type)){let a='<a href="#'+e+'">';return a+=k(e,o,t),a+="</a>",a}if("wowhead"==t.tooltip_engine){let a=document.createElement("a");if(a.href="https://"+("en"===t.language?"www":t.language)+".wowhead.com/",o.hasOwnProperty("item_ids")&&o.item_ids.hasOwnProperty(e)){if(a.href+="item="+o.item_ids[e]+"/"+y(e),void 0!==o.simulated_steps){let t=o.simulated_steps[o.simulated_steps.length-1];"string"==typeof t&&t.indexOf("_")>-1&&(t=t.split("_")[1]),a.href+="&ilvl="+t}}else if(o.hasOwnProperty("spell_ids")&&o.spell_ids.hasOwnProperty(e))a.href+="spell="+o.spell_ids[e]+"/"+y(e);else if("talents"===t.data_type){if("0"===e[1])return e[1];a.href+="spell="+o.talent_data[e[0]][e[1]].spell_id}return"talents"===t.data_type?a.appendChild(document.createTextNode(e[1])):a.appendChild(document.createTextNode(k(e,o,t))),a.outerHTML}if("wowdb"==t.tooltip_engine){let a,l=document.createElement("a");l.href="http://www.wowdb.com/";try{l.href+="items/"+o.item_ids[e]}catch(t){r}if(l.href.indexOf("items")>-1){let t=o.simulated_steps[o.simulated_steps.length-1];"string"==typeof t&&t.indexOf("_")>-1&&(t=t.split("_")[1]),l.href+="?itemLevel="+t}try{l.href+="spells/"+o.spell_ids[e]}catch(t){r}if("talents"===t.data_type){if("0"===e[1])return e[1];l.href+="spells/"+o.talent_data[e[0]][e[1]].spell_id}return l.dataset.tooltipHref=l.href,a="talents"===t.data_type?e[1]:k(e,o,t),l.appendChild(document.createTextNode(a)),l.outerHTML}}function y(t){return t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function b(r){if("highcharts"==r.chart_engine||"highcharts_old"==r.chart_engine){let i="https://bloodmallet.com/";if(void 0!==r.chart_id?i+="chart/"+r.chart_id:void 0!==r.wow_class&&void 0!==r.wow_spec&&void 0!==r.data_type&&(i+="chart/"+r.wow_class+"/"+r.wow_spec+"/"+r.data_type),"secondary_distributions"===r.data_type)return{accessibility:{enabled:!1},credits:{enabled:!1},chart:{renderTo:"scatter_plot_chart",type:"scatter3d",backgroundColor:null,animation:!1,height:800,width:800,options3d:{enabled:!0,alpha:10,beta:30,depth:800,fitToPlot:!1}},legend:{enabled:!0,backgroundColor:r.background_color,borderColor:r.font_color,borderWidth:1,align:"right",verticalAlign:"middle",layout:"vertical",itemStyle:{color:r.font_color},itemHoverStyle:{color:r.font_color}},plotOptions:{series:{dataLabels:{allowOverlap:!0,style:{color:r.font_color,fontSize:r.font_size,fontWeight:"400",textOutline:""}},events:{legendItemClick:function(){return!1}}}},series:[],title:{text:"",useHTML:!0,style:{color:r.font_color}},subtitle:{text:"",useHTML:!0,style:{color:r.font_color,fontSize:r.font_size}},tooltip:{headerFormat:"",pointFormatter:function(){return'<table class="">                <thead>                  <tr>                    <th scope="col"></th>                    <th scope="col">Absolute</th>                    <th scope="col">Relative</th>                  </tr>                </thead>                <tbody>                  <tr>                    <th scope="row">DPS</th>                    <td>'+Intl.NumberFormat().format(this.dps)+"</td>                    <td>"+Math.round(this.dps/this.dps_max*1e4)/100+'%</td>                  </tr>                  <tr>                    <th scope="row">Crit</th>                    <td>'+Intl.NumberFormat().format(this.stat_crit)+"</td>                    <td>"+this.name.split("_")[0]+'%</td>                  </tr>                  <tr>                    <th scope="row">Haste</th>                    <td>'+Intl.NumberFormat().format(this.stat_haste)+"</td>                    <td>"+this.name.split("_")[1]+'%</td>                  </tr>                  <tr>                    <th scope="row">Mastery</th>                    <td>'+Intl.NumberFormat().format(this.stat_mastery)+"</td>                    <td>"+this.name.split("_")[2]+'%</td>                  </tr>                  <tr>                    <th scope="row">Versatility</th>                    <td>'+Intl.NumberFormat().format(this.stat_vers)+"</td>                    <td>"+this.name.split("_")[3]+"%</td>                  </tr>                </tbody>              </table>"},useHTML:!0,borderColor:r.background_color},xAxis:{min:0,max:80,tickInterval:20,startOnTick:!0,endOnTick:!0,title:"",labels:{enabled:!1},gridLineWidth:1,gridLineColor:r.axis_color},yAxis:{min:-10,max:70,tickInterval:20,startOnTick:!0,endOnTick:!0,title:"",labels:{enabled:!1},gridLineWidth:1,gridLineColor:r.axis_color},zAxis:{min:10,max:90,tickInterval:20,startOnTick:!0,endOnTick:!0,title:"",labels:{enabled:!1},reversed:!0,gridLineWidth:1,gridLineColor:r.axis_color}};if("talent_target_scaling"===r.data_type)return{accessibility:{enabled:!1},credits:{href:i,text:"bloodmallet",style:{fontSize:l}},chart:{backgroundColor:null,animation:!1},colors:t,legend:{enabled:!0,backgroundColor:r.background_color,borderColor:r.font_color,borderWidth:1,align:"center",verticalAlign:"top",layout:"horizontal",itemStyle:{color:r.font_color},itemHoverStyle:{color:r.font_color}},plotOptions:{series:{connectNulls:!0,dataLabels:{allowOverlap:!0,style:{color:r.font_color,fontSize:r.font_size,fontWeight:"400",textOutline:""}},events:{legendItemClick:function(){return!1}}}},series:[],title:{text:"",useHTML:!0,style:{color:r.font_color}},subtitle:{text:"",useHTML:!0,style:{color:r.font_color,fontSize:r.font_size}},xAxis:{tickInterval:1,title:{text:"Target count",style:{color:o}},labels:{enabled:!0,style:{color:o}},gridLineWidth:1,gridLineColor:r.axis_color},yAxis:{min:0,title:{text:"DPS",style:{color:o}},labels:{enabled:!0,style:{color:o}},gridLineWidth:1,gridLineColor:r.axis_color}};let n=r.background_color,s=r.axis_color,d=r.font_color,u={accessibility:{enabled:!1},chart:{type:"bar",backgroundColor:e,style:{fontFamily:'-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"'}},colors:t,credits:{href:i,text:"bloodmallet",style:{fontSize:l}},legend:{align:"right",backgroundColor:e,borderColor:a,borderWidth:1,floating:!1,itemMarginBottom:3,itemMarginTop:0,layout:"vertical",reversed:!0,shadow:!1,verticalAlign:"middle",x:0,y:0,itemStyle:{color:o},itemHoverStyle:{color:o},title:{text:" ",style:{color:o}},symbolRadius:0},plotOptions:{series:{stacking:"normal",borderColor:e,events:{legendItemClick:function(){return!1}},style:{textOutline:!1,fontSize:l},point:{events:{click:function(t){var e=this.series.yAxis;e.removePlotLine("helperLine"),e.addPlotLine({value:this.stackY,color:r.font_color,width:2,id:"helperLine",zIndex:5,label:{text:this.series.name+" "+this.category,style:{color:r.font_color,fontSize:l},align:"left",verticalAlign:"bottom",rotation:0,y:-5}})}}}}},series:[],title:{text:"Loading data...",useHTML:!0,style:{color:o,fontSize:l}},subtitle:{text:'...from <a href="https://bloodmallet.com">bloodmallet</a>',useHTML:!0,style:{color:o,fontSize:l}},tooltip:{headerFormat:"<b>{point.x}</b>",shared:!0,backgroundColor:e,borderColor:a,style:{color:o,fontSize:l},useHTML:!0},xAxis:{categories:[],labels:{useHTML:!0,style:{color:o,fontSize:l}},gridLineWidth:0,gridLineColor:a,lineColor:a,tickColor:a},yAxis:[{labels:{style:{color:a}},min:0,stackLabels:{enabled:!0,formatter:function(){return Intl.NumberFormat().format(this.total)},style:{color:o,textOutline:!1,fontSize:l,fontWeight:"normal"}},title:{text:"absolute"===r.value_style?c:h,style:{color:a}},gridLineWidth:1,gridLineColor:a},{linkedTo:0,opposite:!0,labels:{style:{color:a}},min:0,stackLabels:{enabled:!0,formatter:function(){return Intl.NumberFormat().format(this.total)},style:{color:o,textOutline:!1,fontSize:l,fontWeight:"normal"}},title:{text:"absolute"===r.value_style?c:h,style:{color:a}},gridLineWidth:1,gridLineColor:a}]};return u.chart.backgroundColor=n,u.legend.backgroundColor=n,u.legend.borderColor=s,u.legend.itemStyle.color=d,u.legend.itemHoverStyle.color=d,u.title.style.color=d,u.subtitle.style.color=d,u.tooltip.formatter=function(){let t=document.createElement("div");t.style.margin="-4px -7px -7px -7px",t.style.padding="3px 3px 6px 3px",t.style.backgroundColor="transparent"!==n?n:e,"highcharts_old"===r.chart_engine&&(t.style.margin="-7px");let o=document.createElement("div");t.appendChild(o),o.style.marginLeft="9px",o.style.marginRight="9px",o.style.marginBottom="6px",o.style.fontWeight="700",o.innerHTML=this.x;let a=0;for(var l=this.points.length-1;l>=0;l--){a+=this.points[l].y;let e,o=!1,i=0;for(let t of this.points)0!==t.y&&0!==i&&i!==t.y?o=!0:0!==t.y&&0===i&&(i=t.y);if("talents"!==r.data_type){let t=(new DOMParser).parseFromString(this.x,"text/html").body.firstChild.innerText;if(!r.data.data.hasOwnProperty(t)){let e;for(let o of Object.keys(r.data.data))o.slice(o.indexOf("} ")+2)===t&&(e=o);void 0!==e&&(t=e)}void 0===t&&(t=this.x);let o=A(t,r.data,r);r.data.data.hasOwnProperty(o)&&(e=r.data.data[o].hasOwnProperty(this.points[l].series.name))}if(0!==this.points[l].y||e){let e=document.createElement("div");t.appendChild(e);let o=document.createElement("span");e.appendChild(o),o.style.marginLeft="9px",o.style.borderLeft="9px solid "+this.points[l].series.color,o.style.paddingLeft="4px",Number.isInteger(this.points[l].series.name)&&o.appendChild(document.createTextNode(this.points[l].series.name+":"));let i="";["soulbinds","races","talents"].includes(r.data_type)?i="":"relative"===r.value_style&&(i="%"),e.appendChild(document.createTextNode("Â Â "+Intl.NumberFormat().format(a)+i))}}return t.outerHTML},u.tooltip.backgroundColor="transparent"!==n?n:e,u.tooltip.borderColor=s,u.tooltip.style.color=d,u.xAxis.labels.style.color=d,u.xAxis.gridLineColor=s,u.xAxis.lineColor=s,u.xAxis.tickColor=s,u.yAxis[0].labels.style.color=s,u.yAxis[0].stackLabels.style.color=d,u.yAxis[0].gridLineColor=s,u.yAxis[0].lineColor=s,u.yAxis[0].tickColor=s,u.yAxis[0].title.style.color=s,u.yAxis[1].labels.style.color=s,u.yAxis[1].stackLabels.style.color=d,u.yAxis[1].gridLineColor=s,u.yAxis[1].lineColor=s,u.yAxis[1].tickColor=s,u.yAxis[1].title.style.color=s,u.credits.style.color=d,u}}function x(t,e){let o=document.getElementById("chart"),a=o.dataset.filterItemlevels;e?o.dataset.filterItemlevels=a.split(";").filter((e=>e!==t)).join(";"):void 0===a||0===a.length?o.dataset.filterItemlevels=t:o.dataset.filterItemlevels=a+";"+t}function v(t,e){let o=document.getElementById("chart"),a=o.dataset.filterSources;e?o.dataset.filterSources=a.split(";").filter((e=>e!==t)).join(";"):void 0===a||0===a.length?o.dataset.filterSources=t:o.dataset.filterSources=a+";"+t}function w(t){return t.split(" ").map((t=>t[0].toUpperCase()+t.substring(1))).join(" ")}function C(t,e){let o=document.createElement("iframe");return o.title=e,o.width=760,o.height=475,o.src="https://www.raidbots.com/simbot/render/talents/"+t+"?width=750",o}function k(t,e,o){let a="";try{a=e.translations[t][n[o.language]]}catch(e){r,a=t}return void 0===a&&(a=t),a}function O(t,e){return Object.keys(t).find((o=>t[o]===e))}function A(t,e,o){for(let a of Object.keys(e.translations))if(n[o.language]===O(e.translations[a],t))return a;return t}this.init_charts=new function(){let t=document.querySelectorAll("div.bloodmallet_chart"),l=[];for(let e=0;e<t.length;e++){const o=t[e];if(l.indexOf(o.id)>-1)return void console.error("Multiple Elements use the same ID ('"+o.id+"'). Aborting bloodmallet_chart_import.js.");l.push(o.id)}for(let l=0;l<t.length;l++){let i;try{i=t[l].id}catch(t){return void console.error("Each .bloodmallet_chart needs an ID. Aborting bloodmallet_chart_import.js.")}const n=document.getElementById(t[l].id);if(n){let t={chart_id:void 0,wow_class:void 0,wow_spec:void 0,data_type:"trinkets",fight_style:"castingpatchwerk",covenant:"Kyrian",axis_color:a,background_color:e,font_color:o,limit:7,chart_engine:"highcharts",tooltip_engine:"wowhead",language:"en",value_style:"absolute",talent_target_scaling_min_target_count:-1,talent_target_scaling_max_target_count:-1,html_element:n};try{void 0!==bloodmallet.style.axis_color&&(t.axis_color=bloodmallet.style.axis_color),void 0!==bloodmallet.style.background_color&&(t.background_color=bloodmallet.style.background_color),void 0!==bloodmallet.style.font_color&&(t.font_color=bloodmallet.style.font_color),void 0!==bloodmallet.settings.entries&&(t.limit=bloodmallet.settings.entries),void 0!==bloodmallet.settings.chart_engine&&(t.chart_engine=bloodmallet.settings.chart_engine),void 0!==bloodmallet.settings.tooltip_engine&&(t.tooltip_engine=bloodmallet.settings.tooltip_engine),void 0!==bloodmallet.settings.language&&(t.language=bloodmallet.settings.language),void 0!==bloodmallet.settings.value_style&&(t.value_style=bloodmallet.settings.value_style)}catch(t){r}n.getAttribute("data-entries")&&(t.limit=n.getAttribute("data-entries")),n.getAttribute("data-fight-style")&&(t.fight_style=n.getAttribute("data-fight-style")),n.getAttribute("data-type")&&(t.data_type=n.getAttribute("data-type")),n.getAttribute("data-covenant")&&(t.covenant=n.getAttribute("data-covenant")),n.getAttribute("data-background-color")&&(t.background_color=n.getAttribute("data-background-color")),n.getAttribute("data-font-color")&&(t.font_color=n.getAttribute("data-font-color")),n.getAttribute("data-axis-color")&&(t.axis_color=n.getAttribute("data-axis-color")),n.getAttribute("data-tooltip-engine")&&(t.tooltip_engine=n.getAttribute("data-tooltip-engine")),n.getAttribute("data-chart-engine")&&(t.chart_engine=n.getAttribute("data-chart-engine")),n.getAttribute("data-language")&&(t.language=n.getAttribute("data-language")),n.getAttribute("data-value-style")&&(t.value_style=n.getAttribute("data-value-style")),n.getAttribute("data-talent-target-scaling-min-target-count")&&(t.talent_target_scaling_min_target_count=parseInt(n.getAttribute("data-talent-target-scaling-min-target-count"))),n.getAttribute("data-talent-target-scaling-max-target-count")&&(t.talent_target_scaling_max_target_count=parseInt(n.getAttribute("data-talent-target-scaling-max-target-count")));let l=!0;n.getAttribute("data-chart-id")?t.chart_id=n.getAttribute("data-chart-id"):(n.getAttribute("data-wow-class")||(console.error("Required 'data-chart-id' or 'data-wow-class' attribute wasn't found in "+i+"."),l=!1),t.wow_class=n.getAttribute("data-wow-class"),n.getAttribute("data-wow-spec")||(console.error("Required 'data-chart-id' or 'data-wow-spec' attribute wasn't found in "+i+"."),l=!1),t.wow_spec=n.getAttribute("data-wow-spec"));let s=b(t),d=!1;if("highcharts"==t.chart_engine)try{d=Highcharts.chart(i,s)}catch(t){return console.log("When trying to create a highcharts chart the following error occured. Did you include the necessary Highcharts scripts?"),void console.log(t)}else if("highcharts_old"==t.chart_engine)try{let t=s;t.chart.renderTo=i,d=new Highcharts.Chart(t)}catch(t){return console.log("When trying to create a highcharts_old chart the following error occured. Did you include the necessary Highcharts scripts?"),void console.log(t)}l?u(t):d.setTitle({text:"Wrong chart setup"},{text:"Missing 'data-chart-id', 'data-wow-class' or 'data-wow-spec'. See <a href=\"https://github.com/Bloodmallet/bloodmallet_web_frontend/wiki/How-to-import-charts\">wiki</a>"}),setTimeout(p,1,t,n,d,0)}}}}document.addEventListener("DOMContentLoaded",(function(){bloodmallet_chart_import()}));